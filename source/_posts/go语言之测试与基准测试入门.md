---
title: goè¯­è¨€ä¹‹æµ‹è¯•ä¸åŸºå‡†æµ‹è¯•å…¥é—¨
description: 'Go é¼“åŠ±ä½¿ç”¨ç®€æ´çš„è¯­æ³•ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼Œå¸®åŠ©å¼€å‘è€…ä¿è¯ä»£ç è´¨é‡å’Œæ€§èƒ½ã€‚æœ¬æ–‡ç§‘æ™®å‘ï¼Œé¼ é¼ è®¤ä¸ºè¿™ä¸€å—çŸ¥è¯†æƒ³è¦æ·±å…¥å­¦ä¹ è¿˜éœ€è¦åœ¨å…·ä½“é¡¹ç›®ä¸­å®è·µ'
tags: ['go']
toc: false
date: 2025-05-30 18:21:45
categories:
    - go
    - basic
---

## ğŸ“Œ ä¸€ã€Go çš„æµ‹è¯•æ¡†æ¶ä»‹ç»

Go å†…ç½®äº†å¼ºå¤§çš„æµ‹è¯•æ¡†æ¶ï¼Œä¸éœ€è¦ç¬¬ä¸‰æ–¹åº“ï¼Œåªéœ€å¼•å…¥ï¼š

```go
import "testing"
```

æ‰€æœ‰æµ‹è¯•æ–‡ä»¶å¿…é¡»ä»¥ `_test.go` ç»“å°¾ï¼Œæ‰€æœ‰æµ‹è¯•å‡½æ•°ä»¥ `Test` å¼€å¤´ï¼Œå¹¶æ¥å— `*testing.T` å‚æ•°ã€‚

---

## ğŸ“˜ äºŒã€å•å…ƒæµ‹è¯•ï¼ˆUnit Testï¼‰

### âœ… åŸºæœ¬æ ¼å¼

```go
func TestAdd(t *testing.T) {
    result := Add(2, 3)
    if result != 5 {
        t.Errorf("Expected 5, got %d", result)
    }
}
```

### ğŸ“ æ–‡ä»¶ç»“æ„ç¤ºä¾‹

```
calc/
 â”œâ”€â”€ calc.go
 â””â”€â”€ calc_test.go
```

### ğŸ“Œ ç¤ºä¾‹ä»£ç 

```go
// calc.go
package calc

func Add(a, b int) int {
    return a + b
}
```

```go
// calc_test.go
package calc

import "testing"

func TestAdd(t *testing.T) {
    got := Add(1, 2)
    want := 3

    if got != want {
        t.Errorf("Add(1, 2) = %d; want %d", got, want)
    }
}
```

### ğŸš€ è¿è¡Œæµ‹è¯•

```bash
go test
```

---

## ğŸ§ª ä¸‰ã€è¡¨é©±åŠ¨æµ‹è¯•ï¼ˆæ¨èï¼‰

é€‚åˆå¤šä¸ªè¾“å…¥è¾“å‡ºçš„å‡½æ•°æµ‹è¯•ï¼Œæ˜“æ‰©å±•ã€ä»£ç æ›´æ¸…æ™°ã€‚

```go
func TestAddTableDriven(t *testing.T) {
    cases := []struct{
        a, b, expected int
    }{
        {1, 2, 3},
        {2, 2, 4},
        {10, 5, 15},
    }

    for _, c := range cases {
        got := Add(c.a, c.b)
        if got != c.expected {
            t.Errorf("Add(%d, %d) = %d; want %d", c.a, c.b, got, c.expected)
        }
    }
}
```

---

## ğŸ•“ å››ã€åŸºå‡†æµ‹è¯•ï¼ˆBenchmarkï¼‰

ç”¨äºæ€§èƒ½è¯„ä¼°ã€‚å‡½æ•°åä»¥ `Benchmark` å¼€å¤´ï¼Œæ¥æ”¶ `*testing.B` å‚æ•°ã€‚

```go
func BenchmarkAdd(b *testing.B) {
    for i := 0; i < b.N; i++ {
        Add(10, 20)
    }
}
```

æ‰§è¡Œå‘½ä»¤ï¼š

```bash
go test -bench=.
```

---

## ğŸ§ª äº”ã€æµ‹è¯•è¦†ç›–ç‡

æŸ¥çœ‹æµ‹è¯•è¦†ç›–ç‡ï¼š

```bash
go test -cover
```

ç”Ÿæˆè¯¦ç»†æŠ¥å‘Šï¼š

```bash
go test -coverprofile=cover.out
go tool cover -html=cover.out
```

---

## ğŸ§° å…­ã€å®é™…å¼€å‘ä¸­çš„æµ‹è¯•æœ€ä½³å®è·µ

| åšæ³•                   | æè¿°                                                       |
| -------------------- | -------------------------------------------------------- |
| âœ… ä½¿ç”¨è¡¨é©±åŠ¨æµ‹è¯•            | å¯è¯»æ€§å¼ºã€ç»´æŠ¤æ–¹ä¾¿                                                |
| âœ… æµ‹è¯•è¦†ç›–è¾¹ç•Œæ¡ä»¶           | ä¸ä»…æµ‹å¸¸è§„è¾“å…¥ï¼Œè¿˜è¦æµ‹è¯•é”™è¯¯è¾“å…¥ã€é›¶å€¼ç­‰                                     |
| âœ… ä½¿ç”¨å­æµ‹è¯•              | `t.Run("case name", func(t *testing.T) {...})` æœ‰åŠ©äºåˆ†ç»„ç®¡ç†æµ‹è¯• |
| âœ… ä¿æŒæµ‹è¯•å¿«é€Ÿ             | æµ‹è¯•åº”èƒ½å¿«é€Ÿè¿è¡Œï¼Œä¸é˜»å¡å¼€å‘                                           |
| âœ… å¯¹æ¥å£è¿›è¡Œæµ‹è¯•            | æ–¹ä¾¿ mock å’Œæ›¿æ¢                                              |
| âœ… ä½¿ç”¨ `go test -race` | æ£€æŸ¥å¹¶å‘ä»£ç ä¸­çš„æ•°æ®ç«äº‰é—®é¢˜                                           |

---

## ğŸ§ª ä¸ƒã€æµ‹è¯•ä¸­çš„ Mock ä¸ Stubï¼ˆè¿›é˜¶ï¼‰

Go æ²¡æœ‰å†…ç½® mock æ¡†æ¶ï¼Œä½†å¯ä»¥æ‰‹åŠ¨å®šä¹‰æ¥å£å¹¶æ³¨å…¥å‡å®ç°ã€‚

```go
type DB interface {
    GetUser(id int) string
}

type MockDB struct{}

func (m *MockDB) GetUser(id int) string {
    return "mock-user"
}
```

æµ‹è¯•ä¸­ä½¿ç”¨ï¼š

```go
func TestService(t *testing.T) {
    service := NewService(&MockDB{})
    user := service.GetUserName(1)
    if user != "mock-user" {
        t.Fail()
    }
}
```

---

## âœ… æ€»ç»“

| ç±»å‹      | ç”¨æ³•           |
| ------- | ------------ |
| å•å…ƒæµ‹è¯•    | æµ‹è¯•å‡½æ•°æ˜¯å¦è¾“å‡ºæ­£ç¡®ç»“æœ |
| è¡¨é©±åŠ¨æµ‹è¯•   | æµ‹è¯•å¤šä¸ªè¾“å…¥ç»„åˆ     |
| åŸºå‡†æµ‹è¯•    | æµ‹è¯•æ€§èƒ½         |
| å­æµ‹è¯•     | å¤šç»´åº¦ç»„ç»‡æµ‹è¯•      |
| è¦†ç›–ç‡     | æ£€æŸ¥æµ‹è¯•æ˜¯å¦å…¨é¢     |
| Mock æ¥å£ | æ¨¡æ‹Ÿä¾èµ–         |

---