---
title: goè¯­è¨€ä¹‹ç©ºè¿”å›å€¼çš„é€‰æ‹©
description: ''
tags: ['go']
toc: false
date: 2025-06-09 10:16:11
categories:
    - go
    - basic
---

ç´§æ¥ç€ä¸Šä¸€ç¯‡æ–‡ç« å…³äºâ€œç©ºâ€çš„é—®é¢˜ï¼Œåœ¨ Go å¼€å‘ä¸­ç»å¸¸ç¢°åˆ°ï¼š**å‡½æ•°/æ–¹æ³•è¿”å›ç»“æ„ä½“ã€åˆ‡ç‰‡ã€mapã€æŒ‡é’ˆç­‰æ—¶ï¼Œåº”è¯¥è¿”å› `nil`ï¼Œè¿˜æ˜¯è¿”å›ç©ºå€¼ï¼ˆå¦‚ `T{}`ã€`[]T{}`ã€`map[T]U{}`ï¼‰ï¼Ÿ**

<!--more-->

# Go å¼€å‘ä¸­å‡½æ•°è¿”å› nil vs ç©ºå€¼çš„é€‰æ‹©ä¸å®è·µ

è¿™ä¸ªé€‰æ‹©çœ‹ä¼¼ç®€å•ï¼Œå®é™…ä¸Šå¯¹ä»£ç çš„ **å¥å£®æ€§ã€æ˜“è¯»æ€§ã€å…¼å®¹æ€§ï¼ˆå¦‚ JSON åºåˆ—åŒ–** å½±å“éå¸¸å¤§ã€‚

---

## ä¸€ã€è¿”å›ç©ºå€¼ vs nilï¼šå«ä¹‰å¯¹æ¯”

| ç±»å‹           | nil çš„è¯­ä¹‰         | ç©ºå€¼çš„è¯­ä¹‰                  |
| ------------ | --------------- | ---------------------- |
| æŒ‡é’ˆ `*T`      | è¡¨ç¤ºâ€œæ— å¯¹è±¡â€æˆ–â€œä¸å­˜åœ¨â€   | æ— æ„ä¹‰ï¼ˆç»“æ„ä½“æŒ‡é’ˆä¸èƒ½ç”¨ `T{}` è¡¨ç¤ºï¼‰ |
| å€¼ç±»å‹ `T`ï¼ˆç»“æ„ä½“ï¼‰ | ä¸å¯ä¸º nilï¼Œé™¤éç”¨æŒ‡é’ˆ   | æœ‰æ•ˆçš„é›¶å€¼ï¼ˆå­—æ®µé»˜è®¤ï¼‰            |
| åˆ‡ç‰‡ `[]T`     | é€šå¸¸è¡¨ç¤ºâ€œæ— ç»“æœâ€æˆ–â€œæ— æ•°æ®â€ | è¡¨ç¤ºâ€œç»“æœä¸ºç©ºâ€               |
| æ˜ å°„ `map[K]V` | è¡¨ç¤ºâ€œæœªåˆå§‹åŒ–â€        | åˆå§‹åŒ–ä½†ä¸ºç©º                 |

> âœ… å»ºè®®ï¼šåœ¨å¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œ**è¿”å›ç©ºå€¼è€Œé nil** æ›´ç¨³å¥å®‰å…¨ï¼Œå°¤å…¶æ˜¯é›†åˆç±»å‹ã€‚

---

## äºŒã€ä¸åŒç±»å‹çš„è¿”å›è®¾è®¡å»ºè®®åŠè°ƒç”¨ç¤ºä¾‹

### âœ… 1. ç»“æ„ä½“ï¼ˆå€¼ç±»å‹ï¼‰è¿”å› `T{}`

**æ¨èä½¿ç”¨ç©ºç»“æ„ä½“è€ŒéæŒ‡é’ˆæˆ– nil**

#### å‡½æ•°è®¾è®¡ï¼š

```go
type Config struct {
	Port  int
	Debug bool
}

func LoadDefaultConfig() Config {
	return Config{Port: 8080, Debug: false}
}
```

#### è°ƒç”¨åˆ¤æ–­ï¼š

```go
cfg := LoadDefaultConfig()
if cfg.Port == 0 && !cfg.Debug {
	fmt.Println("ä½¿ç”¨é»˜è®¤é…ç½®")
}
```

> ç©ºç»“æ„ä½“è¿”å›å¯é¿å… nil æŒ‡é’ˆé”™è¯¯ï¼Œå¹¶ä¿æŒè‰¯å¥½å°è£…ã€‚

---

### âœ… 2. æŒ‡é’ˆç±»å‹è¿”å› nil è¡¨ç¤ºâ€œæ— ç»“æœâ€

#### å‡½æ•°è®¾è®¡ï¼š

```go
type User struct {
	Name string
}

func FindUserByName(name string) *User {
	if name == "" {
		return nil // æ˜ç¡®è¡¨ç¤ºâ€œæ— ç”¨æˆ·â€
	}
	return &User{Name: name}
}
```

#### è°ƒç”¨åˆ¤æ–­ï¼š

```go
u := FindUserByName("")
if u == nil {
	fmt.Println("ç”¨æˆ·ä¸å­˜åœ¨")
} else {
	fmt.Println("æ‰¾åˆ°ç”¨æˆ·:", u.Name)
}
```

---

### âœ… 3. åˆ‡ç‰‡ï¼šè¿”å› `[]T{}` æ›´å®‰å…¨ï¼Œé¿å… JSON ä¸­å˜æˆ `null`

#### å‡½æ•°è®¾è®¡ï¼š

```go
func GetUserTasks(uid int) []string {
	// æŸ¥è¯¢æ•°æ®åº“...æœªæ‰¾åˆ°ä»»ä½•ä»»åŠ¡
	return []string{}
}
```

#### è°ƒç”¨åˆ¤æ–­ï¼š

```go
tasks := GetUserTasks(42)
if len(tasks) == 0 {
	fmt.Println("å½“å‰æ²¡æœ‰ä»»ä½•ä»»åŠ¡")
} else {
	fmt.Println("ä»»åŠ¡åˆ—è¡¨ï¼š", tasks)
}
```

#### JSON åºåˆ—åŒ–å¯¹æ¯”ï¼š

```go
// è¿”å› nilï¼š "tasks": null
// è¿”å› []ï¼š  "tasks": []
```

> ğŸš« å¦‚æœè¿”å› `nil`ï¼Œå‰ç«¯æˆ–è°ƒç”¨æ–¹å¯èƒ½è¯¯è§£ä¸ºâ€œå€¼æœªåˆå§‹åŒ–â€ã€‚

---

### âœ… 4. mapï¼šè¿”å›ç©º map æ¯” nil æ›´å®‰å…¨

#### å‡½æ•°è®¾è®¡ï¼š

```go
func GetUserSettings(uid int) map[string]string {
	return map[string]string{} // å®‰å…¨è¿”å›ç©º map
}
```

#### è°ƒç”¨åˆ¤æ–­ï¼š

```go
settings := GetUserSettings(42)
if len(settings) == 0 {
	fmt.Println("ä½¿ç”¨ç³»ç»Ÿé»˜è®¤è®¾ç½®")
} else {
	fmt.Println("ç”¨æˆ·è®¾ç½®:", settings)
}
```

#### âš ï¸ å°å¿ƒï¼šnil map å†™å…¥ä¼š panic

```go
var m map[string]string // nil
m["a"] = "b" // âŒ panic: assignment to entry in nil map
```

---

## ä¸‰ã€å®Œæ•´å¯¹æ¯”æ€»ç»“è¡¨

| ç±»å‹            | è¿”å› nil è¡¨ç¤º    | è¿”å›ç©ºå€¼å«ä¹‰    | æ¨èè¿”å›å€¼         |
| ------------- | ------------ | --------- | ------------- |
| `*T`ï¼ˆæŒ‡é’ˆï¼‰      | â€œæ— å¯¹è±¡â€        | ä¸é€‚ç”¨       | `nil` âœ…       |
| `T`ï¼ˆç»“æ„ä½“ï¼‰      | ä¸å¯ä¸º nil      | æœ‰æ•ˆé»˜è®¤å€¼     | `T{}` âœ…       |
| `[]T`ï¼ˆåˆ‡ç‰‡ï¼‰     | â€œæ— æ•°æ®â€æˆ–â€œæŸ¥è¯¢å¤±è´¥â€ | æŸ¥è¯¢æˆåŠŸä½†ä¸ºç©ºç»“æœ | `[]T{}` âœ…     |
| `map[K]V`ï¼ˆæ˜ å°„ï¼‰ | â€œæœªåˆå§‹åŒ–â€       | åˆå§‹åŒ–ä½†ä¸ºç©º    | `map[K]V{}` âœ… |

---

## å››ã€è¡¥å……ï¼šåˆ¤æ–­æ˜¯å¦ä¸º â€œç©ºå€¼â€ çš„æœ€ä½³å†™æ³•

| ç±»å‹    | åˆ¤æ–­æ–¹å¼              | ç¤ºä¾‹                    |
| ----- | ----------------- | --------------------- |
| `[]T` | `len(slice) == 0` | `if len(s) == 0 {}`   |
| `map` | `len(map) == 0`   | `if len(m) == 0 {}`   |
| `*T`  | `pointer == nil`  | `if u == nil {}`      |
| `T`   | åˆ¤æ–­å­—æ®µæ˜¯å¦ä¸ºé»˜è®¤å€¼        | `if cfg.Port == 0 {}` |

---

## äº”ã€å®é™…å¼€å‘ä¸­æ¡ˆä¾‹é€‰å‹å‚è€ƒ

| åœºæ™¯              | å»ºè®®è¿”å›                  | åŸå› è¯´æ˜                      |
| --------------- | --------------------- | ------------------------- |
| æŸ¥è¯¢å•ä¸ªç”¨æˆ·          | `*User` æˆ– `nil`       | å¯è¡¨ç¤ºâ€œç”¨æˆ·ä¸å­˜åœ¨â€                |
| æŸ¥è¯¢è®¢å•åˆ—è¡¨          | `[]Order{}`           | ç©ºåˆ‡ç‰‡æ¸…æ™°è¡¨è¾¾â€œæŸ¥è¯¢æˆåŠŸä½†æ— ç»“æœâ€         |
| è¿”å›é…ç½®é¡¹           | `Config{}`            | ç»“æ„ä½“é›¶å€¼å¯ä½¿ç”¨é»˜è®¤è®¾ç½®              |
| è·å–ç”¨æˆ·è‡ªå®šä¹‰è®¾ç½®       | `map[string]string{}` | ç©º map è¡¨ç¤ºâ€œæ— è®¾ç½®é¡¹â€ï¼Œé¿å…å†™å…¥ panic |
| API JSON è¿”å›ç»“æœå­—æ®µ | `[]T{}`ã€`map{}`       | é¿å…å‰ç«¯å‡ºç° `null`             |

---
