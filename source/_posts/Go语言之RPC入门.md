---
title: Goè¯­è¨€ä¹‹RPCå®è·µå­¦ä¹ ç¬”è®°
description: ''
tags: ['rpc','go']
toc: false
date: 2025-11-16 18:03:16
categories:
    - go
    - basic
---

`net/rpc` æ˜¯ Go è¯­è¨€æ ‡å‡†åº“ä¸­å®ç°è¿œç¨‹è¿‡ç¨‹è°ƒç”¨çš„åˆ©å™¨ï¼Œè™½ç„¶ç°åœ¨ gRPC æ›´ä¸ºæµè¡Œï¼Œä½† `net/rpc` ä»¥å…¶ç®€æ´ã€æ˜“ç”¨å’Œâ€œGo-wayâ€çš„è®¾è®¡å“²å­¦ï¼Œåœ¨å¾ˆå¤šçº¯ Go é¡¹ç›®çš„å†…éƒ¨é€šä¿¡ä¸­ä»ç„¶å æœ‰ä¸€å¸­ä¹‹åœ°ã€‚

<!--more-->

## ğŸ“– Goè¯­è¨€ä¹‹net/rpcï¼šæ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºçŸ³

### 1. ä»€ä¹ˆæ˜¯ RPCï¼Ÿ

**RPC**ï¼ˆRemote Procedure Callï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼‰æ˜¯ä¸€ç§è®¡ç®—æœºé€šä¿¡åè®®ã€‚å®ƒå…è®¸ç¨‹åº**åƒè°ƒç”¨æœ¬åœ°å‡½æ•°ï¼ˆæˆ–æ–¹æ³•ï¼‰ä¸€æ ·ï¼Œå»è°ƒç”¨å¦ä¸€å°è®¡ç®—æœºä¸Šï¼ˆæˆ–å¦ä¸€ä¸ªè¿›ç¨‹ï¼‰çš„å‡½æ•°**ï¼Œè€Œä¸éœ€è¦æ˜¾å¼åœ°å¤„ç†ç½‘ç»œé€šä¿¡çš„å¤æ‚ç»†èŠ‚ã€‚å…³é”®ï¼šè°ƒç”¨çš„å‡½æ•°çš„æ‰§è¡Œç©ºé—´æ˜¯å‘é€æ–¹çš„å†…å­˜ç©ºé—´ï¼Œè€Œä¸æ˜¯æä¾›è€…

RPC çš„æ ¸å¿ƒæ€æƒ³æ˜¯â€œé€æ˜æ€§â€â€”â€”å¼€å‘è€…åº”è¯¥æ„Ÿè§‰ä¸åˆ°è‡ªå·±æ˜¯åœ¨è¿›è¡Œç½‘ç»œè°ƒç”¨ã€‚

### 2. RPC çš„æ ¸å¿ƒåŸç†ä¸è§„èŒƒ

æ— è®ºæ˜¯ Go çš„ `net/rpc` è¿˜æ˜¯ gRPCï¼Œå®ƒä»¬éƒ½éµå¾ªä¸€å¥—ç›¸ä¼¼çš„ RPC å·¥ä½œæµï¼š

1. **å®¢æˆ·ç«¯ï¼ˆClientï¼‰**ï¼š

  - è°ƒç”¨ä¸€ä¸ªæœ¬åœ°çš„â€œå­˜æ ¹â€ï¼ˆStubï¼‰å‡½æ•°ã€‚è¿™ä¸ªå­˜æ ¹å‡½æ•°çœ‹èµ·æ¥å’Œæœ¬åœ°å‡½æ•°ä¸€æ ·ï¼Œä½†å®ƒæ˜¯ç”± RPC æ¡†æ¶ç”Ÿæˆçš„ã€‚

  - **å®¢æˆ·ç«¯å­˜æ ¹ï¼ˆClient Stubï¼‰** æ¥æ”¶åˆ°è°ƒç”¨åï¼Œå°†æ–¹æ³•åï¼ˆä¾‹å¦‚ "UserService.GetUser"ï¼‰å’Œå‚æ•°ï¼ˆä¾‹å¦‚ "UserID: 123"ï¼‰è¿›è¡Œ **â€œåºåˆ—åŒ–â€**ï¼ˆSerializationï¼Œä¹Ÿå«ç¼–ç»„/Marshallingï¼‰ï¼Œå³æŠŠå®ƒä»¬è½¬æ¢æˆäºŒè¿›åˆ¶æˆ–æ–‡æœ¬æ ¼å¼çš„æ•°æ®åŒ…ã€‚

2. **ç½‘ç»œä¼ è¾“ï¼ˆNetworkï¼‰**ï¼š

  - å®¢æˆ·ç«¯å­˜æ ¹é€šè¿‡åº•å±‚çš„ç½‘ç»œåè®®ï¼ˆå¦‚ TCP æˆ– HTTPï¼‰å°†è¿™ä¸ªæ•°æ®åŒ…å‘é€åˆ°æœåŠ¡ç«¯ã€‚

3. **æœåŠ¡ç«¯ï¼ˆServerï¼‰**ï¼š

  - æœåŠ¡ç«¯çš„ **â€œéª¨æ¶â€ï¼ˆSkeletonï¼‰** è´Ÿè´£ç›‘å¬ç½‘ç»œç«¯å£ï¼Œæ¥æ”¶æ•°æ®åŒ…ã€‚

  - **æœåŠ¡ç«¯éª¨æ¶ï¼ˆServer Skeletonï¼‰** æ¥æ”¶åˆ°æ•°æ®åï¼Œè¿›è¡Œ **â€œååºåˆ—åŒ–â€**ï¼ˆDeserializationï¼Œä¹Ÿå«è§£ç»„/Unmarshallingï¼‰ï¼Œè§£æå‡ºæ–¹æ³•åå’Œå‚æ•°ã€‚

  - éª¨æ¶æ ¹æ®æ–¹æ³•åï¼Œè°ƒç”¨æœ¬åœ°æ³¨å†Œçš„å®é™…æœåŠ¡å‡½æ•°ï¼ˆä¾‹å¦‚ `server.GetUser(UserID: 123)`ï¼‰ã€‚

4. **æ‰§è¡Œä¸è¿”å›**ï¼š

  - æœåŠ¡ç«¯æœ¬åœ°å‡½æ•°æ‰§è¡Œå®Œæ¯•ï¼Œå¾—åˆ°ä¸€ä¸ªè¿”å›å€¼ï¼ˆæˆ–é”™è¯¯ï¼‰ã€‚

  - éª¨æ¶å°†è¿™ä¸ªè¿”å›å€¼ **â€œåºåˆ—åŒ–â€**ï¼Œå¹¶é€šè¿‡ç½‘ç»œå‘é€å›å®¢æˆ·ç«¯ã€‚

5. **å®¢æˆ·ç«¯æ¥æ”¶**ï¼š

  - å®¢æˆ·ç«¯å­˜æ ¹æ¥æ”¶è¿”å›çš„æ•°æ®åŒ…ï¼Œ**â€œååºåˆ—åŒ–â€** å‡ºç»“æœã€‚

  - æœ€åï¼Œå­˜æ ¹å°†è¿™ä¸ªç»“æœè¿”å›ç»™æœ€åˆçš„è°ƒç”¨æ–¹ã€‚

åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæœ‰å‡ ä¸ªå…³é”®çš„ **â€œè§„èŒƒâ€** æˆ–â€œè¦ç´ â€ï¼š

- **åºåˆ—åŒ–/ç¼–è§£ç ï¼ˆCodecï¼‰**ï¼šæ•°æ®å¦‚ä½•åœ¨ç½‘ç»œä¸Šä¼ è¾“ï¼Ÿæ˜¯ JSONã€XMLã€Protocol Buffersï¼ˆProtobufï¼‰è¿˜æ˜¯ Go ç‰¹æœ‰çš„ `gob`ï¼Ÿ

- **ç½‘ç»œä¼ è¾“ï¼ˆTransportï¼‰**ï¼šæ•°æ®æ˜¯åŸºäºä»€ä¹ˆåè®®ä¼ è¾“çš„ï¼ŸTCPã€HTTP è¿˜æ˜¯ UDPï¼Ÿ

- **æœåŠ¡å‘ç°ï¼ˆService Discoveryï¼‰**ï¼šå®¢æˆ·ç«¯å¦‚ä½•çŸ¥é“æœåŠ¡ç«¯çš„åœ°å€å’Œç«¯å£ï¼Ÿï¼ˆ`net/rpc` å¯¹æ­¤æ¶‰åŠä¸å¤šï¼Œä½† gRPC å¾ˆçœ‹é‡ï¼‰

- **æ¥å£å®šä¹‰ï¼ˆIDLï¼‰**ï¼šå¦‚ä½•å®šä¹‰å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½è®¤å¯çš„æœåŠ¡æ¥å£ï¼Ÿ

### 3. RPC çš„åº”ç”¨åœºæ™¯

RPC æ˜¯æ„å»º**åˆ†å¸ƒå¼ç³»ç»Ÿ**å’Œ**å¾®æœåŠ¡æ¶æ„**çš„åŸºçŸ³ã€‚

- **å¾®æœåŠ¡é€šä¿¡**ï¼šåœ¨ä¸€ä¸ªå¾®æœåŠ¡ç³»ç»Ÿä¸­ï¼Œè®¢å•æœåŠ¡å¯èƒ½éœ€è¦è°ƒç”¨ç”¨æˆ·æœåŠ¡æ¥è·å–ç”¨æˆ·ä¿¡æ¯ï¼ŒRPC æ˜¯å®ç°è¿™ç§è·¨æœåŠ¡é€šä¿¡æœ€é«˜æ•ˆçš„æ–¹å¼ä¹‹ä¸€ã€‚

- **åˆ†å¸ƒå¼ç³»ç»Ÿ**ï¼šåœ¨æ•°æ®åº“é›†ç¾¤ã€åˆ†å¸ƒå¼è®¡ç®—ï¼ˆå¦‚ MapReduceï¼‰ä¸­ï¼Œä¸»èŠ‚ç‚¹ï¼ˆMasterï¼‰éœ€è¦é€šè¿‡ RPC æ¥åè°ƒå’Œæ§åˆ¶å·¥ä½œèŠ‚ç‚¹ï¼ˆWorkerï¼‰ã€‚

- **å†…éƒ¨å·¥å…·**ï¼šä¸ºå…¬å¸å†…éƒ¨ç³»ç»Ÿæä¾›ä¸€ä¸ªé«˜æ€§èƒ½çš„ API æ¥å£ï¼Œä¾›å…¶ä»–å†…éƒ¨å·¥å…·æˆ–æœåŠ¡è°ƒç”¨ã€‚

---

### 4. æ·±åº¦æ•™ç¨‹ï¼šGo è¯­è¨€ "net/rpc"

Go çš„ `net/rpc` åŒ…åœ¨è®¾è®¡ä¸Šéå¸¸ç®€æ´ï¼Œå¹¶æ·±åº¦é›†æˆäº† Go çš„ç‰¹æ€§ã€‚

#### 4.1 `net/rpc` çš„å¼ºåˆ¶è§„èŒƒ

ä¸ºäº†å®ç°è‡ªåŠ¨åŒ–çš„åºåˆ—åŒ–å’Œæ–¹æ³•æŸ¥æ‰¾ï¼Œ`net/rpc` å¯¹ä½ æš´éœ²çš„æœåŠ¡ï¼ˆServiceï¼‰æœ‰ä¸¥æ ¼çš„â€œæ–¹æ³•ç­¾åâ€è¦æ±‚ï¼š

> **`net/rpc` è§„èŒƒ**

  1. æœåŠ¡å¿…é¡»æ˜¯ä¸€ä¸ª **Go å¯¹è±¡**ï¼ˆé€šå¸¸æ˜¯ç»“æ„ä½“ï¼‰ã€‚

  2. æ–¹æ³•å¿…é¡»æ˜¯ **å¯å¯¼å‡ºçš„**ï¼ˆé¦–å­—æ¯å¤§å†™ï¼‰ã€‚

  3. æ–¹æ³•å¿…é¡» **æœ‰ä¸¤ä¸ªå‚æ•°**ã€‚

  4. ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆ`args`ï¼‰æ˜¯å®¢æˆ·ç«¯ä¼ å…¥çš„å‚æ•°ï¼Œå¿…é¡»æ˜¯å¯å¯¼å‡ºç±»å‹æˆ–Goå†…ç½®ç±»å‹ã€‚

  5. ç¬¬äºŒä¸ªå‚æ•°ï¼ˆ`reply`ï¼‰æ˜¯è¿”å›ç»™å®¢æˆ·ç«¯çš„ç»“æœï¼Œ**å¿…é¡»æ˜¯æŒ‡é’ˆç±»å‹**ã€‚

  6. æ–¹æ³•å¿…é¡»è¿”å›ä¸€ä¸ª `error` ç±»å‹çš„å€¼ã€‚

**æ ‡å‡†ç­¾å**ï¼š`func (t *T) MethodName(args *ArgType, reply *ReplyType) error`

#### 4.2 æ¡ˆä¾‹ä¸€ï¼šåŸºäº TCP çš„ RPCï¼ˆæœ€å¸¸ç”¨ï¼‰

è¿™æ˜¯æœ€ç®€å•ã€æœ€é«˜æ•ˆçš„ `net/rpc` ä½¿ç”¨æ–¹å¼ã€‚å®ƒä½¿ç”¨ Go ç‹¬æœ‰çš„ `gob` ç¼–è§£ç ï¼Œæ€§èƒ½å¾ˆé«˜ï¼Œä½†ç¼ºç‚¹æ˜¯**ä»…é™ Go è¯­è¨€ä¹‹é—´**çš„é€šä¿¡ã€‚

##### æ­¥éª¤1ï¼šå®šä¹‰æœåŠ¡å’Œå‚æ•°

æˆ‘ä»¬æ¥åˆ›å»ºä¸€ä¸ªç®€å•çš„â€œæ•°å­¦â€æœåŠ¡ï¼Œæä¾›ä¸€ä¸ªä¹˜æ³•è®¡ç®—ã€‚

`shared/common.go` (è¿™ä¸ªæ–‡ä»¶å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯éƒ½éœ€è¦)

Go

```Go
package shared

// å‚æ•°
type Args struct {
    A, B int
}

// æœåŠ¡æ–¹æ³•
type MathService struct{}

// Multiply æ–¹æ³•
// (t *T) MethodName(args *ArgType, reply *ReplyType) error
func (t *MathService) Multiply(args *Args, reply *int) error {
    *reply = args.A * args.B
    return nil
}
```


##### æ­¥éª¤2ï¼šç¼–å†™æœåŠ¡ç«¯ (Server)

`server/main.go`

Go

```Go
package main

import (
	"log"
	"net"
	"net/rpc"
	"path/to/shared" // æ›¿æ¢ä¸ºä½ çš„
)

func main() {
	// 1. åˆ›å»ºä¸€ä¸ª MathService çš„å®ä¾‹
	mathService := new(shared.MathService)

	// 2. æ³¨å†ŒæœåŠ¡
	// rpc.Register ä¼šä½¿ç”¨åå°„æ¥åˆ†æå¯¹è±¡çš„æ‰€æœ‰å¯å¯¼å‡ºæ–¹æ³•
	err := rpc.Register(mathService)
	if err != nil {
		log.Fatalf("æ³¨å†ŒæœåŠ¡å¤±è´¥: %v", err)
	}

	// 3. è®¾ç½®ç›‘å¬ç«¯å£ (TCP)
	listener, err := net.Listen("tcp", ":1234")
	if err != nil {
		log.Fatalf("ç›‘å¬å¤±è´¥: %v", err)
	}
	defer listener.Close()

	log.Println("RPC æœåŠ¡å™¨æ­£åœ¨ç›‘å¬ :1234")

	// 4. æ¥å—è¿æ¥å¹¶å¤„ç†
	// rpc.Accept ä¼šåœ¨å¾ªç¯ä¸­æ¥å—è¿æ¥ï¼Œå¹¶ä¸ºæ¯ä¸ªè¿æ¥å¯åŠ¨ä¸€ä¸ª goroutine æ¥å¤„ç†
	rpc.Accept(listener)
}
```


##### æ­¥éª¤3ï¼šç¼–å†™å®¢æˆ·ç«¯ (Client)

`client/main.go`

Go

```Go
package main

import (
	"log"
	"net/rpc"
	"path/to/shared" // æ›¿æ¢ä¸ºä½ çš„
)

func main() {
	// 1. è¿æ¥ RPC æœåŠ¡å™¨
	// rpc.Dial(protocol, address)
	client, err := rpc.Dial("tcp", "localhost:1234")
	if err != nil {
		log.Fatalf("è¿æ¥ RPC æœåŠ¡å™¨å¤±è´¥: %v", err)
	}

	// 2. å‡†å¤‡å‚æ•°
	args := &shared.Args{A: 10, B: 20}
	var reply int

	// 3. è°ƒç”¨è¿œç¨‹æ–¹æ³•
	// client.Call("ServiceName.MethodName", args, &reply)
	// ServiceName é»˜è®¤æ˜¯æ³¨å†Œçš„ç»“æ„ä½“ç±»å‹åï¼Œå³ "MathService"
	err = client.Call("MathService.Multiply", args, &reply)
	if err != nil {
		log.Fatalf("è°ƒç”¨è¿œç¨‹æ–¹æ³•å¤±è´¥: %v", err)
	}

	// 4. è·å¾—ç»“æœ
	log.Printf("MathService.Multiply(10, 20) = %d", reply)

	// æ¼”ç¤ºï¼šå¼‚æ­¥è°ƒç”¨ (Async Call)
	// å¦‚æœä½ ä¸å¸Œæœ›é˜»å¡ç­‰å¾…ç»“æœï¼Œå¯ä»¥ä½¿ç”¨ Go() æ–¹æ³•
	var asyncReply int
	call := client.Go("MathService.Multiply", &shared.Args{A: 5, B: 6}, &asyncReply, nil)

	// ... åœ¨è¿™é‡Œå¯ä»¥åšå…¶ä»–äº‹æƒ… ...

	// ç­‰å¾…å¼‚æ­¥è°ƒç”¨å®Œæˆ
	replyCall := <-call.Done
	if replyCall.Error != nil {
		log.Fatalf("å¼‚æ­¥è°ƒç”¨å¤±è´¥: %v", replyCall.Error)
	}
	log.Printf("å¼‚æ­¥è°ƒç”¨ MathService.Multiply(5, 6) = %d", asyncReply)
}
```


#### 4.3 æ¡ˆä¾‹äºŒï¼šåŸºäº HTTP çš„ RPC

`net/rpc` ä¹Ÿå¯ä»¥â€œå¯„å®¿â€åœ¨ HTTP åè®®ä¸Šã€‚è¿™éå¸¸æœ‰ç”¨ï¼Œå› ä¸ºå®ƒå…è®¸ RPC æ•°æ®ç©¿è¿‡é˜²ç«å¢™ï¼Œå¹¶å¯ä»¥å¤ç”¨å·²æœ‰çš„ HTTP åŸºç¡€è®¾æ–½ï¼ˆå¦‚ TLSã€ä¸­é—´ä»¶ç­‰ï¼‰ã€‚

**æœåŠ¡ç«¯ (Server)**

Go

```Go
package main

import (
	"log"
	"net/http"
	"net/rpc"
	"path/to/shared"
)

func main() {
	mathService := new(shared.MathService)
	rpc.Register(mathService)

	// 1. å°† RPC æœåŠ¡ç»‘å®šåˆ° HTTP å¤„ç†å™¨
	// è¿™ä¼šæš´éœ²ä¸€ä¸ªé»˜è®¤çš„ RPC è·¯å¾„ï¼ˆ_goRPC_ï¼‰
	rpc.HandleHTTP()

	log.Println("RPC æœåŠ¡å™¨æ­£åœ¨ç›‘å¬ HTTP :1234")

	// 2. å¯åŠ¨ HTTP æœåŠ¡å™¨
	if err := http.ListenAndServe(":1234", nil); err != nil {
		log.Fatal(err)
	}
}
```


**å®¢æˆ·ç«¯ (Client)**

Go

```Go
package main

import (
	"log"
	"net/rpc"
	"path/to/shared"
)

func main() {
	// 1. ä½¿ç”¨ rpc.DialHTTP è¿æ¥
	// å®¢æˆ·ç«¯ä¼šè‡ªåŠ¨å¤„ç† HTTP POST å’Œè·¯å¾„
	client, err := rpc.DialHTTP("tcp", "localhost:1234")
	if err != nil {
		log.Fatalf("è¿æ¥ RPC æœåŠ¡å™¨å¤±è´¥: %v", err)
	}

	// 2. è°ƒç”¨ï¼ˆä¸ TCP æ¡ˆä¾‹å®Œå…¨ç›¸åŒï¼‰
	args := &shared.Args{A: 10, B: 20}
	var reply int
	err = client.Call("MathService.Multiply", args, &reply)
	if err != nil {
		log.Fatalf("è°ƒç”¨è¿œç¨‹æ–¹æ³•å¤±è´¥: %v", err)
	}

	log.Printf("MathService.Multiply(10, 20) = %d", reply)
}
```


#### 4.4 æ¡ˆä¾‹ä¸‰ï¼šä½¿ç”¨ JSON-RPCï¼ˆå®ç°è·¨è¯­è¨€ï¼‰

`net/rpc` é»˜è®¤çš„ `gob` ç¼–ç å¯¼è‡´å®ƒåªèƒ½ Go â†” Goã€‚ä½†æ ‡å‡†åº“æä¾›äº† `net/rpc/jsonrpc` åŒ…ï¼Œå®ƒå…è®¸æˆ‘ä»¬ä½¿ç”¨ **JSON** ä½œä¸ºç¼–è§£ç å™¨ã€‚

è¿™æ„å‘³ç€ä»»ä½•æ”¯æŒ JSON-RPC çš„è¯­è¨€ï¼ˆå¦‚ Python, JavaScriptï¼‰éƒ½å¯ä»¥è°ƒç”¨ä½ çš„ Go RPC æœåŠ¡ï¼

**æœåŠ¡ç«¯ (Server)**

Go

```Go
package main

import (
	"log"
	"net"
	"net/rpc"
	"net/rpc/jsonrpc" // 1. å¯¼å…¥ jsonrpc
	"path/to/shared"
)

func main() {
	rpc.Register(new(shared.MathService))
	
	listener, err := net.Listen("tcp", ":1234")
	if err != nil {
		log.Fatal(err)
	}
	defer listener.Close()
	log.Println("JSON-RPC æœåŠ¡å™¨æ­£åœ¨ç›‘å¬ :1234")

	for {
		conn, err := listener.Accept()
		if err != nil {
			log.Println(err)
			continue
		}
		// 2. ä½¿ç”¨ jsonrpc.ServeConn æ›¿æ¢ rpc.ServeConn
		go jsonrpc.ServeConn(conn)
	}
}
```


**å®¢æˆ·ç«¯ (Client - Go)**

Go

```Go
package main

import (
	"log"
	"net/rpc/jsonrpc" // 1. å¯¼å…¥ jsonrpc
	"path/to/shared"
)

func main() {
	// 2. ä½¿ç”¨ jsonrpc.Dial æ›¿æ¢ rpc.Dial
	client, err := jsonrpc.Dial("tcp", "localhost:1234")
	if err != nil {
		log.Fatal(err)
	}

	// è°ƒç”¨æ–¹å¼ä¸å˜
	args := &shared.Args{A: 10, B: 20}
	var reply int
	err = client.Call("MathService.Multiply", args, &reply)
	if err != nil {
		log.Fatal(err)
	}
	log.Printf("JSON-RPC è°ƒç”¨ç»“æœ: %d", reply)
}
```


---

### 5. å±•æœ›æœªæ¥ï¼šgRPC

è™½ç„¶ `net/rpc` éå¸¸è½»å·§æ˜“ç”¨ï¼Œä½†å®ƒä¹Ÿå­˜åœ¨ä¸€äº›å±€é™æ€§ï¼š

6. **Go ç»‘å®š**ï¼šé»˜è®¤çš„ `gob` ç¼–è§£ç å¯¼è‡´å…¶ç”Ÿæ€å°é—­ã€‚

7. **æ€§èƒ½**ï¼šJSON ç¼–è§£ç æ€§èƒ½è¾ƒå·®ï¼›`gob` è™½å¿«ï¼Œä½†ä¸å¦‚ Protobufã€‚

8. **åŠŸèƒ½é™åˆ¶**ï¼šä¸æ”¯æŒ**æµå¼ï¼ˆStreamingï¼‰** è°ƒç”¨ã€æ²¡æœ‰è¿æ¥å¤ç”¨ã€æ²¡æœ‰å†…ç½®çš„æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡æˆ–è®¤è¯æœºåˆ¶ã€‚

**gRPC** (Google Remote Procedure Call) æ˜¯ Google æ¨å‡ºçš„ç°ä»£ RPC æ¡†æ¶ï¼Œå®ƒè§£å†³äº†ä¸Šè¿°æ‰€æœ‰é—®é¢˜ï¼Œå·²æˆä¸ºäº‘åŸç”Ÿæ—¶ä»£å¾®æœåŠ¡çš„é¦–é€‰ã€‚

#### gRPC çš„æ ¸å¿ƒä¼˜åŠ¿

9. **Protocol Buffers (Protobuf)**ï¼š

  - gRPC é»˜è®¤ä½¿ç”¨ Protobuf ä½œä¸ºå…¶ **IDLï¼ˆæ¥å£å®šä¹‰è¯­è¨€ï¼‰** å’Œåºåˆ—åŒ–å·¥å…·ã€‚

  - Protobuf æ˜¯ä¸€ç§è¯­è¨€æ— å…³ã€å¹³å°æ— å…³ã€å¯æ‰©å±•çš„åºåˆ—åŒ–ç»“æ„æ•°æ®çš„æ–¹æ³•ï¼ˆç±»ä¼¼ JSONï¼Œä½†æ›´å°ã€æ›´å¿«ã€æ›´å¼ºï¼‰ã€‚

  - ä½ åªéœ€è¦åœ¨ä¸€ä¸ª `.proto` æ–‡ä»¶ä¸­å®šä¹‰æœåŠ¡å’Œæ¶ˆæ¯ï¼ŒgRPC çš„å·¥å…·é“¾ (protoc) å°±èƒ½è‡ªåŠ¨ç”Ÿæˆ**æ‰€æœ‰è¯­è¨€**ï¼ˆGo, Java, Python, C++, Node.js ç­‰ï¼‰çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä»£ç ã€‚

10. **åŸºäº HTTP/2**ï¼š

  - `net/rpc` é€šå¸¸åŸºäº TCP æˆ– HTTP/1.1ã€‚

  - gRPC å»ºç«‹åœ¨ **HTTP/2** ä¹‹ä¸Šï¼Œå¸¦æ¥äº†å·¨å¤§ä¼˜åŠ¿ï¼š

    - **å¤šè·¯å¤ç”¨ï¼ˆMultiplexingï¼‰**ï¼šå…è®¸åœ¨å•ä¸ª TCP è¿æ¥ä¸ŠåŒæ—¶å¤„ç†å¤šä¸ªåŒå‘è¯·æ±‚å’Œå“åº”ï¼Œè§£å†³äº†â€œé˜Ÿå¤´é˜»å¡â€é—®é¢˜ï¼Œæå¤§æå‡äº†å¹¶å‘æ€§èƒ½ã€‚

    - **å¤´éƒ¨å‹ç¼©ï¼ˆHeader Compressionï¼‰**ï¼šå‡å°‘äº†è¯·æ±‚çš„å¼€é”€ã€‚

    - **æœåŠ¡ç«¯æ¨é€ï¼ˆServer Pushï¼‰**ã€‚

11. **æ”¯æŒæµå¼ï¼ˆStreamingï¼‰**ï¼š

  - è¿™æ˜¯ gRPC çš„æ€æ‰‹çº§ç‰¹æ€§ã€‚`net/rpc` åªèƒ½â€œä¸€é—®ä¸€ç­”â€ï¼ˆUnary RPCï¼‰ã€‚

  - gRPC æ”¯æŒå››ç§é€šä¿¡æ¨¡å¼ï¼š

    1. **Unary RPC**ï¼ˆä¸€å…ƒRPCï¼‰ï¼šåŒ `net/rpc`ã€‚

    2. **Server-streaming RPC**ï¼ˆæœåŠ¡ç«¯æµï¼‰ï¼šå®¢æˆ·ç«¯å‘ä¸€ä¸ªè¯·æ±‚ï¼ŒæœåŠ¡ç«¯å¯ä»¥åƒæ•°æ®æµä¸€æ ·æŒç»­è¿”å›å¤šä¸ªå“åº”ï¼ˆä¾‹å¦‚è®¢é˜…é€šçŸ¥ï¼‰ã€‚

    3. **Client-streaming RPC**ï¼ˆå®¢æˆ·ç«¯æµï¼‰ï¼šå®¢æˆ·ç«¯å¯ä»¥åƒæ•°æ®æµä¸€æ ·æŒç»­å‘é€å¤šä¸ªæ¶ˆæ¯ï¼ŒæœåŠ¡ç«¯æœ€åè¿”å›ä¸€ä¸ªå“åº”ï¼ˆä¾‹å¦‚ä¸Šä¼ å¤§æ–‡ä»¶ï¼‰ã€‚

    4. **Bidirectional-streaming RPC**ï¼ˆåŒå‘æµï¼‰ï¼šå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯ä»¥åŒæ—¶ã€ç‹¬ç«‹åœ°å‘å¯¹æ–¹å‘é€æ•°æ®æµï¼ˆä¾‹å¦‚å®æ—¶èŠå¤©ï¼‰ã€‚

#### `net/rpc` vs gRPC

|**ç‰¹æ€§**|**net/rpc (æ ‡å‡†åº“)**|**gRPC (Google)**|
|-|-|-|
|**åºåˆ—åŒ–**|é»˜è®¤ `gob` (Go-only)ï¼Œå¯é€‰ JSON|**Protocol Buffers** (é«˜æ€§èƒ½, äºŒè¿›åˆ¶)|
|**ä¼ è¾“åè®®**|TCP æˆ– HTTP/1.1|**HTTP/2** (é«˜æ€§èƒ½, å¤šè·¯å¤ç”¨)|
|**è·¨è¯­è¨€**|è¾ƒå·® (éœ€ä½¿ç”¨ `jsonrpc`)|**æå¼º** (è‡ªåŠ¨ç”Ÿæˆå¤šè¯­è¨€ä»£ç )|
|**æµå¤„ç†**|ä¸æ”¯æŒ (ä»… ä¸€é—®ä¸€ç­”)|**æ”¯æŒ** (ä¸€å…ƒã€å®¢æˆ·ç«¯æµã€æœåŠ¡ç«¯æµã€åŒå‘æµ)|
|**ç”Ÿæ€ç³»ç»Ÿ**|åŸºç¡€ (æ ‡å‡†åº“)|**éå¸¸ä¸°å¯Œ** (æœåŠ¡å‘ç°ã€è´Ÿè½½å‡è¡¡ã€è®¤è¯ã€Trace)|
|**æ˜“ç”¨æ€§**|**éå¸¸ç®€å•** (çº¯ Go é¡¹ç›®çš„å¿«é€Ÿé€‰æ‹©)|å­¦ä¹ æ›²çº¿ç¨é«˜ (éœ€å®šä¹‰ `.proto` æ–‡ä»¶)|

### æ€»ç»“

`net/rpc` æ˜¯ Go è¯­è¨€â€œå°è€Œç¾â€å“²å­¦çš„ä½“ç°ã€‚å¦‚æœä½ æ­£åœ¨æ„å»ºä¸€ä¸ª**çº¯ Go è¯­è¨€**çš„å†…éƒ¨ç³»ç»Ÿï¼Œä¸å¸Œæœ›å¼•å…¥å¤æ‚çš„ `.proto` æ–‡ä»¶å’Œ gRPC ä¾èµ–ï¼Œ`net/rpc` åŠå…¶ `jsonrpc` å˜ä½“ä»ç„¶æ˜¯ä¸€ä¸ªä¼˜ç§€ã€è½»é‡ä¸”é«˜æ•ˆçš„é€‰æ‹©ã€‚

ç„¶è€Œï¼Œå¦‚æœä½ åœ¨æ„å»ºé¢å‘æœªæ¥çš„ã€é«˜æ€§èƒ½ã€è·¨è¯­è¨€çš„**å¾®æœåŠ¡**ç³»ç»Ÿï¼Œé‚£ä¹ˆ `gRPC` æ¯«æ— ç–‘é—®æ˜¯å½“ä»Šçš„æ ‡å‡†ç­”æ¡ˆã€‚

---



