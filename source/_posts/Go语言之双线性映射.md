---
title: Goè¯­è¨€ä¹‹åŒçº¿æ€§æ˜ å°„
description: 'å¤ä¹ ä¸€ä¸‹åŒçº¿æ€§æ˜ å°„'
tags: ['go','ç§‘ç ”','å¯†ç å­¦']
toc: false
date: 2025-07-02 14:27:16
categories:
    - ç§‘ç ”
    - å¯†ç å­¦
---


å½“ç„¶å¯ä»¥ï¼ä¸‹é¢æ˜¯å¯¹â€œä¸€ã€åŒçº¿æ€§å¯¹ï¼šé€šä¿—è®²è§£å¤ä¹ â€è¿™ä¸€èŠ‚çš„**é‡æ–°ç¼–å†™**ï¼Œå†…å®¹æ›´è¯¦ç»†ã€æ¯”å–»æ›´ä¸°å¯Œï¼Œå®Œå…¨ä¸ºæ²¡æœ‰æŠ½è±¡ä»£æ•°åŸºç¡€çš„è¯»è€…è®¾è®¡ï¼Œç¡®ä¿çœŸæ­£ç†è§£åŒçº¿æ€§å¯¹çš„**æ˜¯ä»€ä¹ˆã€æœ‰ä»€ä¹ˆç”¨ã€ä¸ºä»€ä¹ˆé‡è¦**ã€‚

---

## ğŸ§© ä¸€ã€åŒçº¿æ€§å¯¹ï¼šä»0å¼€å§‹çš„é€šä¿—è®²è§£

### ğŸŸ¢ 1. ä»æœ€ç†Ÿæ‚‰çš„æ•°å­¦è¯´èµ·ï¼šåŠ æ³•å’Œä¹˜æ³•çš„å…³ç³»

å°æ—¶å€™ä¸€å®šå­¦è¿‡è¿™æ ·çš„è§„å¾‹ï¼š

$$
(a \cdot b) + (a \cdot c) = a \cdot (b + c)
$$

è¿™è¯´æ˜ï¼šä¹˜æ³•å¯¹åŠ æ³•æ˜¯â€œçº¿æ€§çš„â€â€”â€”ä¹˜æ³•å¯ä»¥åˆ†å¸ƒåœ¨åŠ æ³•ä¸Šã€‚

æ•°å­¦å®¶æŠŠâ€œå…·æœ‰çº¿æ€§ç‰¹æ€§â€çš„ä¸œè¥¿ç»Ÿç§°ä¸º **çº¿æ€§æ˜ å°„**ã€‚
è€Œå½“ä¸€ä¸ªå‡½æ•°åœ¨**ä¸¤ä¸ªå˜é‡ä¸Šéƒ½å…·æœ‰çº¿æ€§ç‰¹æ€§**æ—¶ï¼Œå®ƒå°±å«**åŒçº¿æ€§æ˜ å°„ï¼ˆBilinear Mappingï¼‰**ã€‚

æˆ‘ä»¬æ¥çœ‹ä¸ªç®€å•çš„ä¾‹å­ï¼š

---

### ğŸ§® 2. ä»€ä¹ˆæ˜¯â€œåŒçº¿æ€§â€å‡½æ•°ï¼Ÿï¼ˆä¸¾ä¾‹å­ï¼‰

å‡è®¾æœ‰è¿™æ ·ä¸€ä¸ªå‡½æ•° $f(x, y) = x \cdot y$ï¼Œä½ å¯ä»¥è¯•è¯•ï¼š

$$
f(2, 3) = 2 \cdot 3 = 6 \\
f(2+4, 3) = f(6, 3) = 18 = f(2, 3) + f(4, 3)
$$

ä¹Ÿå°±æ˜¯è¯´ï¼š

$$
f(x_1 + x_2, y) = f(x_1, y) + f(x_2, y)
$$

åŒæ—¶ä¹Ÿæˆç«‹ï¼š

$$
f(x, y_1 + y_2) = f(x, y_1) + f(x, y_2)
$$

è¿™æ ·çš„å‡½æ•°ï¼Œæˆ‘ä»¬å°±ç§°ä¹‹ä¸ºâ€œåŒçº¿æ€§å‡½æ•°â€ã€‚

---

### ğŸ” 3. é‚£ä»€ä¹ˆæ˜¯â€œåŒçº¿æ€§å¯¹â€ï¼Ÿï¼ˆpairingï¼‰

ç°åœ¨æˆ‘ä»¬æŠŠåœºæ™¯æ¬åˆ°å¯†ç å­¦ä½¿ç”¨çš„ç¾¤ç»“æ„ä¸­ã€‚

æˆ‘ä»¬å¼•å…¥ä¸‰ä¸ªç¾¤ï¼š

| ç¾¤     | æ˜¯ä»€ä¹ˆ                      |
| ----- | ------------------------ |
| $G_1$ | ç¬¬ä¸€ä¸ªç¾¤ï¼Œå…ƒç´ å¯ä»¥æ˜¯æ¤­åœ†æ›²çº¿ä¸Šçš„ç‚¹        |
| $G_2$ | ç¬¬äºŒä¸ªç¾¤ï¼Œä¹Ÿæ˜¯ä¸€ç»„ç‰¹æ®Šç‚¹             |
| $G_T$ | ç›®æ ‡ç¾¤ï¼Œç”¨æ¥å­˜å‚¨ç»“æœï¼ˆé€šå¸¸æ˜¯æ•´æ•°æˆ–å…¶ä»–å­—æ®µå…ƒç´ ï¼‰ |

æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼š

$$
e: G_1 \times G_2 \rightarrow G_T
$$

è¿™å°±æ˜¯**pairing å‡½æ•°**ï¼Œä¹Ÿå«**åŒçº¿æ€§å¯¹**ã€‚

å®ƒæ¥æ”¶ä¸¤ä¸ªè¾“å…¥ï¼Œåˆ†åˆ«æ¥è‡ª $G_1$ å’Œ $G_2$ï¼Œè¾“å‡ºä¸€ä¸ªå€¼åœ¨ $G_T$ ä¸­ã€‚

---

### ğŸ¯ 4. pairing å‡½æ•°å¿…é¡»æ»¡è¶³ä»€ä¹ˆæ¡ä»¶ï¼Ÿ

#### âœ… 1. åŒçº¿æ€§ï¼ˆæœ€é‡è¦çš„é­”æ³•ï¼‰

å¯¹äºä»»æ„æ•´æ•° $a, b$ï¼Œç‚¹ $P \in G_1, Q \in G_2$ï¼Œæœ‰ï¼š

$$
e(aP, bQ) = e(P, Q)^{ab}
$$

è¿™ç›¸å½“äºè¯´ï¼š

* å¦‚æœä½ æŠŠ P ç‚¹æ”¾å¤§ $a$ å€ã€Q ç‚¹æ”¾å¤§ $b$ å€
* é‚£ä¹ˆ pairing çš„ç»“æœå°±ç›¸å½“äºï¼šåŸå§‹ pairing çš„ç»“æœå†â€œæå‡åˆ° ab æ¬¡æ–¹â€

ğŸ“Œ **è¿™ä¸ªæŒ‡æ•°è½¬æ¢èƒ½åŠ›æ˜¯ pairing æœ€å¤§çš„é­”åŠ›**
å®ƒèƒ½æŠŠç‚¹ä¹‹é—´çš„è¿ç®—å˜æˆæŒ‡æ•°ä¹‹é—´çš„å…³ç³»ï¼

---

#### âœ… 2. éé€€åŒ–ï¼ˆä¸èƒ½æ’ç­‰äº 1ï¼‰

æˆ‘ä»¬å¸Œæœ› $e(P, Q) \neq 1$ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œä¸æ˜¯æ— è®ºè¾“å…¥ä»€ä¹ˆéƒ½è¾“å‡º 1ï¼‰ï¼Œè¿™æ · pairing æ‰æœ‰å®é™…ç”¨é€”ã€‚

#### âœ… 3. å¯è®¡ç®—ï¼ˆç®—æ³•èƒ½åœ¨åˆç†æ—¶é—´å†…ç®—å‡ºæ¥ï¼‰

pairing å¿…é¡»è¦èƒ½ç”¨ç¨‹åºå®ç°ï¼Œä¸èƒ½åªæ˜¯æ•°å­¦ç†è®ºã€‚

---

### ğŸ” 5. pairing çš„å½¢è±¡æ¯”å–»ï¼ˆéå¸¸é‡è¦ï¼‰

ä½ å¯ä»¥æŠŠ pairing å‡½æ•°æƒ³è±¡æˆä¸€ä¸ªâ€œæ™ºèƒ½è½¬æ¢å™¨â€ï¼Œå®ƒçš„ä½œç”¨æ˜¯ï¼š

| è¾“å…¥             | è¾“å‡º     | ä¿ç•™äº†ä»€ä¹ˆ                           |
| -------------- | ------ | ------------------------------- |
| æ¤­åœ†æ›²çº¿ä¸Šçš„ç‚¹ $P, Q$ | æ•°å­— $Z$ | æŒ‡æ•°å…³ç³»ï¼Œä¾‹å¦‚ $aP, bQ \rightarrow ab$ |

---

#### ğŸ¨ ç±»æ¯”ç”Ÿæ´»åœºæ™¯ï¼š

å‡è®¾ï¼š

* $P$ï¼šä»£è¡¨ä¸€å°åŠ å¯†é‚®ä»¶
* $Q$ï¼šä»£è¡¨ä¸€ä¸ªç”¨æˆ·èº«ä»½
* pairing å°±æ˜¯ä¸€ä¸ªéªŒè¯å™¨

å®ƒèƒ½ç®—å‡º $e(P, Q)$ï¼Œå¹¶ä¸”è¿™ä¸ªå€¼å…·æœ‰å¾ˆå¼ºçš„**ä¸€è‡´æ€§å’Œå¯éªŒè¯æ€§**ï¼Œè€Œä¸”åˆ«äººä¸èƒ½ä»¿é€ ï¼

---

### ğŸš€ 6. pairing åœ¨å¯†ç å­¦çš„ç”¨å¤„

å› ä¸º pairing ä¿ç•™äº†å€æ•°/æŒ‡æ•°çš„å…³ç³»ï¼Œå®ƒéå¸¸é€‚åˆåšè¿™äº›äº‹ï¼š

| åº”ç”¨          | pairing åšäº†ä»€ä¹ˆ            |
| ----------- | ----------------------- |
| èº«ä»½åŠ å¯†ï¼ˆIBEï¼‰   | è®©é‚®ç®±å½“å…¬é’¥ï¼Œä¸ç”¨å‘è¯ä¹¦            |
| å¯æœç´¢åŠ å¯†ï¼ˆPEKSï¼‰ | è®©äº‘ç«¯å¯ä»¥æœç´¢å…³é”®è¯ä½†çœ‹ä¸åˆ°åŸæ–‡        |
| BLS ç­¾å      | ç”¨ pairing éªŒè¯ç­¾ååˆæ³•æ€§ï¼Œç­¾åç‰¹åˆ«çŸ­ |
| å±æ€§åŠ å¯†        | ç”¨ pairing åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æ»¡è¶³è®¿é—®æ¡ä»¶  |

> pairing æ˜¯è¿™äº›ç°ä»£å¯†ç æœºåˆ¶çš„â€œå‘åŠ¨æœºâ€ã€‚

---

## ğŸ’» äºŒã€Go å®ç° pairing éªŒè¯ï¼ˆåŸºç¡€ï¼‰

ä½¿ç”¨ [Cloudflare çš„ bn256](https://pkg.go.dev/github.com/cloudflare/bn256) åº“ã€‚

### âœ… pairing éªŒè¯å…¬å¼ï¼š

$$
e(aP, bQ) = e(P, Q)^{ab}
$$

```go
package main

import (
	"crypto/rand"
	"fmt"
	"math/big"

	"github.com/cloudflare/bn256"
)

func main() {
	a, _ := rand.Int(rand.Reader, bn256.Order)
	b, _ := rand.Int(rand.Reader, bn256.Order)

	P := new(bn256.G1).ScalarBaseMult(big.NewInt(1))
	Q := new(bn256.G2).ScalarBaseMult(big.NewInt(1))

	aP := new(bn256.G1).ScalarMult(P, a)
	bQ := new(bn256.G2).ScalarMult(Q, b)

	p1 := bn256.Pair(aP, bQ)
	p2 := bn256.Pair(P, Q)
	ab := new(big.Int).Mul(a, b)
	p2.Exp(p2, ab)

	fmt.Println("e(aP,bQ) == e(P,Q)^ab ?", p1.String() == p2.String())
}
```

è¾“å‡ºåº”è¯¥æ˜¯ï¼š

```
e(aP,bQ) == e(P,Q)^ab ? true
```

---

## ğŸ” ä¸‰ã€ä»€ä¹ˆæ˜¯ PEKSï¼Ÿ

### âœ… é—®é¢˜èƒŒæ™¯

* ä½ åŠ å¯†äº†ä¸€å †é‚®ä»¶æˆ–æ–‡ä»¶ï¼Œå­˜åœ¨äº‘ç«¯
* ä½ å¸Œæœ›â€œæœç´¢å…³é”®è¯â€ï¼ˆå¦‚ "salary"ï¼‰è€Œ**ä¸æš´éœ²å†…å®¹**
* æ›´é‡è¦çš„æ˜¯ï¼Œäº‘æœåŠ¡å•†**ä¸èƒ½è§£å¯†åŸæ–‡**

### âœ… PEKSï¼ˆPublic Key Encryption with Keyword Searchï¼‰

PEKS æ˜¯ä¸€ç§åŠ å¯†æ–¹æ³•ï¼Œå®ƒå¯ä»¥ï¼š

* è®©äº‘ç«¯ä½¿ç”¨â€œé™·é—¨â€æ£€æŸ¥æŸå¯†æ–‡æ˜¯å¦åŒ…å«æŸå…³é”®è¯
* ä½†äº‘ç«¯æ— æ³•çŸ¥é“å…³é”®è¯æˆ–å¯†æ–‡å†…å®¹

å®ƒçš„æ ¸å¿ƒæœºåˆ¶å°±ä¾èµ– **pairingï¼ˆåŒçº¿æ€§å¯¹ï¼‰**ã€‚

---

## âš™ï¸ å››ã€PEKS æ¶æ„ä¸åŸç†

å‚è€ƒ Boneh ç­‰äººåœ¨ 2004 å¹´æå‡ºçš„ PEKS ç³»ç»Ÿã€‚

### å‚ä¸è€…

* **å‘é€æ–¹**ï¼šåŠ å¯†å…³é”®è¯
* **æ¥æ”¶æ–¹**ï¼šç”Ÿæˆé™·é—¨ï¼ˆtrapdoorï¼‰
* **æœåŠ¡å™¨**ï¼šåˆ¤æ–­å¯†æ–‡æ˜¯å¦åŒ¹é…é™·é—¨ï¼ˆä¸å¯å¾—å‡ºå…³é”®è¯ï¼‰

### æ ¸å¿ƒç»“æ„

1. å…¬é’¥ç³»ç»Ÿï¼šåŸºäº pairing çš„æ¤­åœ†æ›²çº¿ç³»ç»Ÿ
2. PEKS å¯†æ–‡ç»“æ„ï¼š

   $$
   (A, B) = (r \cdot P, H(w) \oplus e(P_{pub}, H(w))^r)
   $$
3. åˆ¤æ–­å¼ï¼ˆåœ¨æœåŠ¡å™¨ä¸Šï¼‰ï¼š
   æ£€æŸ¥ï¼š

   $$
   e(A, H(w')) = B'
   $$

---

## ğŸ› ï¸ äº”ã€Go å®ç° PEKS ç³»ç»Ÿ

ä¸€ä¸ªç®€åŒ–ç‰ˆç³»ç»Ÿï¼š

* ä½¿ç”¨ SHA256 ä»£æ›¿æ›²çº¿ä¸Šçš„ hash-to-point
* æ¨¡æ‹Ÿå…³é”®æ­¥éª¤ï¼Œè®©ä½ ç†è§£ PEKS çš„ pairing å·¥ä½œæ–¹å¼

### ğŸ“ go.mod

```go
module peks-demo

go 1.20

require github.com/cloudflare/bn256 v0.0.0-20230823074015-81eab1aa433a
```

---

### ğŸ“„ main.go

```go
package main

import (
	"crypto/rand"
	"crypto/sha256"
	"fmt"
	"math/big"

	"github.com/cloudflare/bn256"
)

// æŠŠå…³é”®è¯è½¬ä¸º G1 ç¾¤ä¸­çš„ç‚¹ï¼ˆæ¨¡æ‹Ÿ hash-to-curveï¼‰
func hashToG1(keyword string) *bn256.G1 {
	hash := sha256.Sum256([]byte(keyword))
	h := new(big.Int).SetBytes(hash[:])
	return new(bn256.G1).ScalarBaseMult(h)
}

// å¯†é’¥å¯¹ç»“æ„
type KeyPair struct {
	Priv *big.Int
	Pub  *bn256.G2
}

// ç”Ÿæˆå¯†é’¥å¯¹
func generateKeyPair() KeyPair {
	x, _ := rand.Int(rand.Reader, bn256.Order)
	Pub := new(bn256.G2).ScalarBaseMult(x)
	return KeyPair{Priv: x, Pub: Pub}
}

// PEKS åŠ å¯†
func PEKS(pubKey *bn256.G2, keyword string) (A *bn256.G1, B *bn256.GT) {
	r, _ := rand.Int(rand.Reader, bn256.Order)
	Hw := hashToG1(keyword)
	A = new(bn256.G1).ScalarBaseMult(r)
	B = bn256.Pair(Hw, pubKey)
	B.Exp(B, r)
	return
}

// ç”Ÿæˆé™·é—¨
func Trapdoor(privKey *big.Int, keyword string) *bn256.G1 {
	Hw := hashToG1(keyword)
	return new(bn256.G1).ScalarMult(Hw, privKey)
}

// æ£€æŸ¥å…³é”®è¯æ˜¯å¦åŒ¹é…
func Test(A *bn256.G1, B *bn256.GT, Tw *bn256.G1) bool {
	pair := bn256.Pair(A, Tw)
	return pair.String() == B.String()
}

func main() {
	// å…³é”®è¯åŠ å¯†æ–¹
	keyword := "salary"

	// ç”¨æˆ·ç”Ÿæˆå¯†é’¥å¯¹
	keys := generateKeyPair()

	// åŠ å¯†å…³é”®è¯
	A, B := PEKS(keys.Pub, keyword)
	fmt.Println("ğŸ” PEKS å¯†æ–‡ç”Ÿæˆå®Œæ¯•")

	// æ”¶ä»¶äººç”Ÿæˆé™·é—¨
	tw := Trapdoor(keys.Priv, "salary")

	// æœåŠ¡å™¨æµ‹è¯•åŒ¹é…
	result := Test(A, B, tw)
	fmt.Printf("ğŸ’¡ å…³é”®è¯åŒ¹é…ç»“æœ: %v\n", result)

	// é”™è¯¯å…³é”®è¯æµ‹è¯•
	twWrong := Trapdoor(keys.Priv, "bonus")
	resultWrong := Test(A, B, twWrong)
	fmt.Printf("ğŸ§ª é”™è¯¯å…³é”®è¯æµ‹è¯•ç»“æœ: %v\n", resultWrong)
}
```

---

## ğŸ§ª ç¤ºä¾‹è¾“å‡º

```
ğŸ” PEKS å¯†æ–‡ç”Ÿæˆå®Œæ¯•
ğŸ’¡ å…³é”®è¯åŒ¹é…ç»“æœ: true
ğŸ§ª é”™è¯¯å…³é”®è¯æµ‹è¯•ç»“æœ: false
```

---

