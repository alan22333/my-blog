---
title: gnarké›¶çŸ¥è¯†è¯æ˜å®æˆ˜æŒ‡å—
description: 'Goè¯­è¨€ä¸­æµè¡Œçš„é›¶çŸ¥è¯†è¯æ˜åº“ï¼ˆZKï¼‰'
tags: ['å¯†ç å­¦',"ZK"]
toc: false
date: 2025-10-11 14:21:38
categories:
    - ç§‘ç ”
    - å¯†ç å­¦
---
# gnark é›¶çŸ¥è¯†è¯æ˜å®æˆ˜æŒ‡å—

> ä»é›¶åˆ°ä¸€æŒæ¡ zkSNARK å¼€å‘ï¼šç†è®ºã€å®è·µä¸åº”ç”¨åœºæ™¯å…¨è§£æ

## ğŸ“š ç›®å½•

1. [é›¶çŸ¥è¯†è¯æ˜åŸºç¡€](#é›¶çŸ¥è¯†è¯æ˜åŸºç¡€)
2. [gnark æ¡†æ¶ä»‹ç»](#gnark-æ¡†æ¶ä»‹ç»)
3. [æ ¸å¿ƒæ¦‚å¿µè¯¦è§£](#æ ¸å¿ƒæ¦‚å¿µè¯¦è§£)
4. [å¼€å‘å®æˆ˜](#å¼€å‘å®æˆ˜)
5. [åº”ç”¨åœºæ™¯](#åº”ç”¨åœºæ™¯)
6. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
7. [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
8. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## é›¶çŸ¥è¯†è¯æ˜åŸºç¡€

### ä»€ä¹ˆæ˜¯é›¶çŸ¥è¯†è¯æ˜ï¼Ÿ

é›¶çŸ¥è¯†è¯æ˜ï¼ˆZero-Knowledge Proof, ZKPï¼‰æ˜¯ä¸€ç§å¯†ç å­¦åè®®ï¼Œå…è®¸ä¸€æ–¹ï¼ˆè¯æ˜è€… Proverï¼‰å‘å¦ä¸€æ–¹ï¼ˆéªŒè¯è€… Verifierï¼‰è¯æ˜æŸä¸ªé™ˆè¿°æ˜¯çœŸå®çš„ï¼Œè€Œ**æ— éœ€é€éœ²ä»»ä½•é¢å¤–ä¿¡æ¯**ã€‚

#### ç»å…¸ä¾‹å­ï¼šé˜¿é‡Œå·´å·´çš„æ´ç©´

æƒ³è±¡ä¸€ä¸ªç¯å½¢æ´ç©´ï¼Œä¸­é—´æœ‰ä¸€æ‰‡éœ€è¦å¯†ç æ‰èƒ½æ‰“å¼€çš„é—¨ï¼š

```
     å…¥å£
      |
   /--+--\
  A       B
   \     /
    \é—¨/
```

- Alice å£°ç§°å¥¹çŸ¥é“å¯†ç 
- Bob æƒ³éªŒè¯ä½†ä¸æƒ³çŸ¥é“å¯†ç 
- Alice è¿›å…¥æ´ç©´ï¼Œéšæœºé€‰æ‹© A æˆ– B è·¯å¾„
- Bob åœ¨å…¥å£éšæœºå–Š "ä» A å‡ºæ¥" æˆ– "ä» B å‡ºæ¥"
- å¦‚æœ Alice çœŸçš„çŸ¥é“å¯†ç ï¼Œå¥¹æ€»èƒ½ä»æŒ‡å®šå‡ºå£å‡ºæ¥
- é‡å¤å¤šæ¬¡åï¼ŒBob ç¡®ä¿¡ Alice çŸ¥é“å¯†ç ï¼Œä½†ä»–è‡ªå·±å¹¶ä¸çŸ¥é“å¯†ç æ˜¯ä»€ä¹ˆ

### ä¸‰å¤§æ ¸å¿ƒå±æ€§

1. **å®Œå¤‡æ€§ï¼ˆCompletenessï¼‰**
   - å¦‚æœé™ˆè¿°ä¸ºçœŸï¼Œè¯šå®çš„è¯æ˜è€…æ€»èƒ½è¯´æœéªŒè¯è€…
   - æ­£ç¡®çš„è¾“å…¥ â†’ è¯æ˜ä¸€å®šé€šè¿‡

2. **å¯é æ€§ï¼ˆSoundnessï¼‰**
   - å¦‚æœé™ˆè¿°ä¸ºå‡ï¼Œæ¬ºè¯ˆçš„è¯æ˜è€…æ— æ³•æ¬ºéª—éªŒè¯è€…
   - é”™è¯¯çš„è¾“å…¥ â†’ è¯æ˜ä¸€å®šå¤±è´¥
   - å³ä½¿æ”»å‡»è€…æœ‰å·¨å¤§ç®—åŠ›ä¹Ÿæ— æ³•ä¼ªé€ 

3. **é›¶çŸ¥è¯†æ€§ï¼ˆZero-Knowledgeï¼‰**
   - éªŒè¯è€…é™¤äº†"é™ˆè¿°ä¸ºçœŸ"ä¹‹å¤–ï¼Œå­¦ä¸åˆ°ä»»ä½•å…¶ä»–ä¿¡æ¯
   - ç§æœ‰æ•°æ®ä¿æŒå®Œå…¨éšç§

### zkSNARK vs zkSTARK

| ç‰¹æ€§ | zkSNARK | zkSTARK |
|-----|---------|---------|
| å…¨ç§° | Zero-Knowledge Succinct Non-Interactive ARgument of Knowledge | Zero-Knowledge Scalable Transparent ARgument of Knowledge |
| è¯æ˜å¤§å° | å¾ˆå°ï¼ˆ~200 bytesï¼‰ | è¾ƒå¤§ï¼ˆ~100 KBï¼‰ |
| éªŒè¯é€Ÿåº¦ | æå¿«ï¼ˆ~1 msï¼‰ | å¿«ï¼ˆ~10 msï¼‰ |
| ç”Ÿæˆé€Ÿåº¦ | å¿« | è¾ƒæ…¢ |
| å¯ä¿¡è®¾ç½® | éœ€è¦ | ä¸éœ€è¦ |
| é‡å­æŠ—æ€§ | âŒ æ—  | âœ… æœ‰ |
| é€‚ç”¨åœºæ™¯ | åŒºå—é“¾ã€éšç§äº¤æ˜“ | å¤§è§„æ¨¡è®¡ç®—è¯æ˜ |

æœ¬æ•™ç¨‹èšç„¦äº **zkSNARKï¼ˆGroth16ï¼‰**ï¼Œå®ƒæ˜¯ç›®å‰æœ€æˆç†Ÿã€åº”ç”¨æœ€å¹¿çš„æ–¹æ¡ˆã€‚

---

## gnark æ¡†æ¶ä»‹ç»

### ä¸ºä»€ä¹ˆé€‰æ‹© gnarkï¼Ÿ

[gnark](https://github.com/ConsenSys/gnark) æ˜¯ ConsenSys å¼€å‘çš„é«˜æ€§èƒ½ Go è¯­è¨€ zkSNARK æ¡†æ¶ã€‚

#### æ ¸å¿ƒä¼˜åŠ¿

âœ… **é«˜æ€§èƒ½**
- ç”Ÿäº§çº§æ€§èƒ½ä¼˜åŒ–
- æ”¯æŒå¹¶è¡Œè®¡ç®—
- ç¼–è¯‘é€Ÿåº¦å¿«

âœ… **æ˜“ç”¨æ€§**
- ç®€æ´çš„ API è®¾è®¡
- å¼ºç±»å‹æ£€æŸ¥
- ä¸°å¯Œçš„æ–‡æ¡£

âœ… **å¤šåç«¯æ”¯æŒ**
- Groth16ï¼ˆæœ€æµè¡Œï¼‰
- PlonK
- å³å°†æ”¯æŒ STARK

âœ… **å·¥ä¸šçº§åº”ç”¨**
- è¢«å¤šä¸ªåŒºå—é“¾é¡¹ç›®é‡‡ç”¨
- ç»è¿‡å¤§é‡å®¡è®¡
- æ´»è·ƒçš„ç¤¾åŒºæ”¯æŒ

âœ… **å®Œæ•´ç”Ÿæ€**
- gnark-cryptoï¼šåº•å±‚å¯†ç å­¦åº“
- gnarkï¼šç”µè·¯ç¼–è¯‘å’Œè¯æ˜ç”Ÿæˆ
- ä¸°å¯Œçš„æ ‡å‡†åº“ï¼ˆå“ˆå¸Œã€ç­¾åã€Merkle æ ‘ç­‰ï¼‰

### æ¡†æ¶å¯¹æ¯”

| æ¡†æ¶ | è¯­è¨€ | åç«¯ | æˆç†Ÿåº¦ | å­¦ä¹ æ›²çº¿ |
|-----|------|-----|-------|---------|
| **gnark** | Go | Groth16, PlonK | â­â­â­â­â­ | ä¸­ç­‰ |
| circom | JavaScript | Groth16, PlonK | â­â­â­â­â­ | è¾ƒä½ |
| bellman | Rust | Groth16 | â­â­â­â­ | è¾ƒé«˜ |
| libsnark | C++ | Groth16 | â­â­â­â­ | é«˜ |

---

## æ ¸å¿ƒæ¦‚å¿µè¯¦è§£

### 1. ç”µè·¯ï¼ˆCircuitï¼‰

ç”µè·¯æ˜¯é›¶çŸ¥è¯†è¯æ˜çš„æ ¸å¿ƒï¼Œå®šä¹‰äº†è¦è¯æ˜çš„è®¡ç®—é€»è¾‘ã€‚

#### ç”µè·¯ç»“æ„

```go
type MyCircuit struct {
    // ç§æœ‰è¾“å…¥ï¼ˆè¯æ˜è€…çŸ¥é“ï¼Œä½†ä¸ä¼šæ³„éœ²ï¼‰
    PrivateInput frontend.Variable `gnark:"private_input"`
    
    // å…¬å¼€è¾“å…¥ï¼ˆæ‰€æœ‰äººéƒ½èƒ½çœ‹åˆ°ï¼‰
    PublicInput frontend.Variable `gnark:",public"`
    
    // å…¬å¼€è¾“å‡ºï¼ˆè®¡ç®—ç»“æœï¼‰
    Output frontend.Variable `gnark:",public"`
}
```

#### çº¦æŸå®šä¹‰

```go
func (circuit *MyCircuit) Define(api frontend.API) error {
    // å®šä¹‰è®¡ç®—é€»è¾‘å’Œçº¦æŸæ¡ä»¶
    // æ‰€æœ‰çº¦æŸå¿…é¡»æ»¡è¶³ï¼Œè¯æ˜æ‰èƒ½ç”Ÿæˆ
    
    // ç¤ºä¾‹ï¼šoutput = private_input + public_input
    sum := api.Add(circuit.PrivateInput, circuit.PublicInput)
    api.AssertIsEqual(circuit.Output, sum)
    
    return nil
}
```

### 2. çº¦æŸç³»ç»Ÿï¼ˆConstraint Systemï¼‰

çº¦æŸç³»ç»Ÿæ˜¯ç”µè·¯çš„æ•°å­¦è¡¨ç¤ºå½¢å¼ã€‚

#### R1CSï¼ˆRank-1 Constraint Systemï¼‰

R1CS æ˜¯æœ€å¸¸è§çš„çº¦æŸç³»ç»Ÿï¼Œæ¯ä¸ªçº¦æŸçš„å½¢å¼ä¸ºï¼š

```
(aâ‚Â·xâ‚ + aâ‚‚Â·xâ‚‚ + ... ) Â· (bâ‚Â·xâ‚ + bâ‚‚Â·xâ‚‚ + ... ) = (câ‚Â·xâ‚ + câ‚‚Â·xâ‚‚ + ... )
```

gnark è‡ªåŠ¨å°†é«˜çº§ç”µè·¯ä»£ç ç¼–è¯‘ä¸º R1CSã€‚

#### çº¦æŸç±»å‹

- **ç­‰å¼çº¦æŸ**ï¼š`api.AssertIsEqual(a, b)`
- **ä¸ç­‰å¼çº¦æŸ**ï¼š`api.AssertIsLessOrEqual(a, b)`
- **å¸ƒå°”çº¦æŸ**ï¼š`api.AssertIsBoolean(a)`
- **ç®—æœ¯çº¦æŸ**ï¼š`Add`, `Sub`, `Mul`, `Div`

### 3. è§è¯ï¼ˆWitnessï¼‰

è§è¯æ˜¯ç”µè·¯ä¸­æ‰€æœ‰å˜é‡çš„å…·ä½“èµ‹å€¼ã€‚

```go
// åˆ›å»ºè§è¯
assignment := MyCircuit{
    PrivateInput: 42,    // ç§æœ‰å€¼
    PublicInput:  10,    // å…¬å¼€å€¼
    Output:       52,    // è¾“å‡ºå€¼
}

witness, _ := frontend.NewWitness(&assignment, ecc.BN254.ScalarField())
```

### 4. è¯æ˜ç³»ç»Ÿæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Setup é˜¶æ®µï¼ˆä¸€æ¬¡æ€§ï¼‰                  â”‚
â”‚  1. å®šä¹‰ç”µè·¯                                             â”‚
â”‚  2. ç¼–è¯‘ä¸º R1CS                                          â”‚
â”‚  3. ç”Ÿæˆè¯æ˜å¯†é’¥ (pk) å’ŒéªŒè¯å¯†é’¥ (vk)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Prove é˜¶æ®µï¼ˆæ¯æ¬¡è¯æ˜ï¼‰                  â”‚
â”‚  1. å‡†å¤‡è§è¯ï¼ˆç§æœ‰+å…¬å¼€è¾“å…¥ï¼‰                             â”‚
â”‚  2. ä½¿ç”¨ pk ç”Ÿæˆè¯æ˜                                     â”‚
â”‚  3. è¾“å‡ºï¼šproof + å…¬å¼€è¾“å…¥                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Verify é˜¶æ®µï¼ˆå¿«é€ŸéªŒè¯ï¼‰                  â”‚
â”‚  1. æ¥æ”¶ï¼šproof + å…¬å¼€è¾“å…¥                                â”‚
â”‚  2. ä½¿ç”¨ vk éªŒè¯                                         â”‚
â”‚  3. è¾“å‡ºï¼šâœ… é€šè¿‡ / âŒ æ‹’ç»                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å¼€å‘å®æˆ˜

### æ¡ˆä¾‹ 1ï¼šå¹´é¾„éªŒè¯ï¼ˆå…¥é—¨ï¼‰

**åœºæ™¯**ï¼šè¯æ˜ä½ å¹´æ»¡ 18 å²ï¼Œä½†ä¸æ³„éœ²å…·ä½“å¹´é¾„ã€‚

```go
package main

import (
    "github.com/consensys/gnark-crypto/ecc"
    "github.com/consensys/gnark/backend/groth16"
    "github.com/consensys/gnark/frontend"
    "github.com/consensys/gnark/frontend/cs/r1cs"
)

// AgeCircuit è¯æ˜å¹´é¾„ >= 18
type AgeCircuit struct {
    Age       frontend.Variable `gnark:"age"`        // ç§æœ‰ï¼šå®é™…å¹´é¾„
    AgeLimit  frontend.Variable `gnark:",public"`    // å…¬å¼€ï¼šå¹´é¾„é™åˆ¶ï¼ˆ18ï¼‰
    IsAdult   frontend.Variable `gnark:",public"`    // å…¬å¼€ï¼šæ˜¯å¦æˆå¹´
}

func (circuit *AgeCircuit) Define(api frontend.API) error {
    // çº¦æŸ1ï¼šå¹´é¾„å¿…é¡» >= é™åˆ¶
    api.AssertIsLessOrEqual(circuit.AgeLimit, circuit.Age)
    
    // çº¦æŸ2ï¼šisAdult å¿…é¡»ä¸º 1ï¼ˆè¡¨ç¤ºæˆå¹´ï¼‰
    api.AssertIsEqual(circuit.IsAdult, 1)
    
    return nil
}

func main() {
    // Setup
    var circuit AgeCircuit
    ccs, _ := frontend.Compile(ecc.BN254.ScalarField(), r1cs.NewBuilder, &circuit)
    pk, vk, _ := groth16.Setup(ccs)
    
    // Proveï¼šAlice 25 å²
    assignment := AgeCircuit{
        Age:      25,  // ç§æœ‰
        AgeLimit: 18,  // å…¬å¼€
        IsAdult:  1,   // å…¬å¼€
    }
    witness, _ := frontend.NewWitness(&assignment, ecc.BN254.ScalarField())
    publicWitness, _ := witness.Public()
    proof, _ := groth16.Prove(ccs, pk, witness)
    
    // Verify
    err := groth16.Verify(proof, vk, publicWitness)
    if err == nil {
        println("âœ… éªŒè¯é€šè¿‡ï¼šç”¨æˆ·å¹´æ»¡ 18 å²")
        println("   ä½†æˆ‘ä»¬ä¸çŸ¥é“ç”¨æˆ·çš„å…·ä½“å¹´é¾„ï¼")
    }
}
```

**å…³é”®ç‚¹**ï¼š
- éªŒè¯è€…åªçœ‹åˆ° `AgeLimit=18` å’Œ `IsAdult=1`
- å®é™…å¹´é¾„ `Age=25` å®Œå…¨ä¿å¯†
- æ— æ³•ä¼ªé€ ï¼ˆå¦‚æœå¹´é¾„ < 18ï¼Œè¯æ˜ç”Ÿæˆä¼šå¤±è´¥ï¼‰

### æ¡ˆä¾‹ 2ï¼šæ•°ç‹¬è§£ç­”éªŒè¯ï¼ˆè¿›é˜¶ï¼‰

**åœºæ™¯**ï¼šè¯æ˜ä½ çŸ¥é“æ•°ç‹¬çš„è§£ï¼Œä½†ä¸æ³„éœ²ç­”æ¡ˆã€‚

```go
type SudokuCircuit struct {
    // ç§æœ‰ï¼šå®Œæ•´çš„è§£ç­”ï¼ˆ81ä¸ªæ•°å­—ï¼‰
    Solution [81]frontend.Variable `gnark:"solution"`
    
    // å…¬å¼€ï¼šåˆå§‹è°œé¢˜ï¼ˆ0 è¡¨ç¤ºç©ºæ ¼ï¼‰
    Puzzle [81]frontend.Variable `gnark:",public"`
}

func (circuit *SudokuCircuit) Define(api frontend.API) error {
    // çº¦æŸ1ï¼šè°œé¢˜ä¸­çš„éé›¶æ•°å­—å¿…é¡»ä¸è§£ç­”ä¸€è‡´
    for i := 0; i < 81; i++ {
        // å¦‚æœè°œé¢˜ä½ç½®æœ‰æ•°å­—ï¼Œè§£ç­”å¿…é¡»ç›¸åŒ
        isGiven := api.IsZero(circuit.Puzzle[i])
        match := api.IsZero(api.Sub(circuit.Puzzle[i], circuit.Solution[i]))
        api.AssertIsEqual(api.Or(isGiven, match), 1)
    }
    
    // çº¦æŸ2ï¼šæ¯è¡ŒåŒ…å« 1-9ï¼ˆæ— é‡å¤ï¼‰
    for row := 0; row < 9; row++ {
        checkUnique(api, circuit.Solution[row*9:(row+1)*9])
    }
    
    // çº¦æŸ3ï¼šæ¯åˆ—åŒ…å« 1-9ï¼ˆæ— é‡å¤ï¼‰
    for col := 0; col < 9; col++ {
        var column [9]frontend.Variable
        for row := 0; row < 9; row++ {
            column[row] = circuit.Solution[row*9+col]
        }
        checkUnique(api, column[:])
    }
    
    // çº¦æŸ4ï¼šæ¯ä¸ª 3x3 å®«æ ¼åŒ…å« 1-9ï¼ˆæ— é‡å¤ï¼‰
    // ... ç±»ä¼¼å®ç°
    
    return nil
}
```

**åº”ç”¨ä»·å€¼**ï¼š
- åœ¨çº¿æ¸¸æˆï¼šéªŒè¯ç©å®¶è§£ç­”æ­£ç¡®æ€§
- ç«èµ›ç³»ç»Ÿï¼šé˜²æ­¢ä½œå¼Šä½†ä¿æŠ¤ç­”æ¡ˆ
- æ•™è‚²å¹³å°ï¼šè‡ªåŠ¨æ‰¹æ”¹ä½†ä¸æ³„éœ²æ ‡å‡†ç­”æ¡ˆ

### æ¡ˆä¾‹ 3ï¼šå¯†ç ç™»å½•ï¼ˆå®ç”¨ï¼‰

**åœºæ™¯**ï¼šè¯æ˜çŸ¥é“å¯†ç ï¼Œä½†ä¸åœ¨ç½‘ç»œä¸Šä¼ è¾“å¯†ç ã€‚

```go
type PasswordCircuit struct {
    // ç§æœ‰ï¼šç”¨æˆ·çš„å¯†ç 
    Password frontend.Variable `gnark:"password"`
    
    // å…¬å¼€ï¼šå¯†ç çš„å“ˆå¸Œï¼ˆæœåŠ¡å™¨å­˜å‚¨ï¼‰
    PasswordHash frontend.Variable `gnark:",public"`
}

func (circuit *PasswordCircuit) Define(api frontend.API) error {
    // è®¡ç®—å¯†ç çš„å“ˆå¸Œ
    mimc, _ := mimc.NewMiMC(api)
    mimc.Write(circuit.Password)
    computedHash := mimc.Sum()
    
    // éªŒè¯å“ˆå¸ŒåŒ¹é…
    api.AssertIsEqual(circuit.PasswordHash, computedHash)
    
    return nil
}
```

**ä¼˜åŠ¿**ï¼š
- å¯†ç æ°¸ä¸ä¼ è¾“ï¼ˆå³ä½¿è¢«ç›‘å¬ä¹Ÿå®‰å…¨ï¼‰
- æœåŠ¡å™¨åªå­˜å‚¨å“ˆå¸Œ
- æŠ—é‡å­æ”»å‡»ï¼ˆå–å†³äºå“ˆå¸Œå‡½æ•°é€‰æ‹©ï¼‰

### æ¡ˆä¾‹ 4ï¼šMerkle æ ‘æˆå‘˜è¯æ˜ï¼ˆé«˜çº§ï¼‰

**åœºæ™¯**ï¼šè¯æ˜æŸä¸ªæ•°æ®åœ¨ Merkle æ ‘ä¸­ï¼Œä½†ä¸æ³„éœ²å…¶ä»–æ•°æ®ã€‚

```go
import "github.com/consensys/gnark/std/accumulator/merkle"

type MerkleCircuit struct {
    // ç§æœ‰ï¼šå¶å­èŠ‚ç‚¹æ•°æ®
    Leaf frontend.Variable `gnark:"leaf"`
    
    // ç§æœ‰ï¼šMerkle è·¯å¾„
    Path []frontend.Variable `gnark:"path"`
    
    // å…¬å¼€ï¼šMerkle æ ¹
    Root frontend.Variable `gnark:",public"`
}

func (circuit *MerkleCircuit) Define(api frontend.API) error {
    // ä»å¶å­èŠ‚ç‚¹å‘ä¸Šè®¡ç®—åˆ°æ ¹
    currentHash := circuit.Leaf
    
    for i := 0; i < len(circuit.Path); i++ {
        mimc, _ := mimc.NewMiMC(api)
        mimc.Write(currentHash)
        mimc.Write(circuit.Path[i])
        currentHash = mimc.Sum()
    }
    
    // éªŒè¯è®¡ç®—å‡ºçš„æ ¹ä¸å…¬å¼€çš„æ ¹ä¸€è‡´
    api.AssertIsEqual(currentHash, circuit.Root)
    
    return nil
}
```

**åº”ç”¨åœºæ™¯**ï¼š
- åŒºå—é“¾ï¼šè½»å®¢æˆ·ç«¯éªŒè¯äº¤æ˜“
- éšç§æŠ•ç¥¨ï¼šè¯æ˜æŠ•ç¥¨æƒä½†ä¸æ³„éœ²èº«ä»½
- ç©ºæŠ•èµ„æ ¼ï¼šè¯æ˜åœ¨ç™½åå•ä¸­ä½†ä¸å…¬å¼€åˆ—è¡¨

---

## åº”ç”¨åœºæ™¯

### 1. åŒºå—é“¾ä¸åŠ å¯†è´§å¸

#### éšç§äº¤æ˜“ï¼ˆå¦‚ Zcashï¼‰

```
ä¼ ç»Ÿäº¤æ˜“ï¼š
Alice â†’ Bob: 10 ETH
â†‘ æ‰€æœ‰äººéƒ½èƒ½çœ‹åˆ°é‡‘é¢å’Œåœ°å€

ZK éšç§äº¤æ˜“ï¼š
Alice â†’ Bob: ??? ETH
â†‘ åªèƒ½çœ‹åˆ°äº¤æ˜“æœ‰æ•ˆï¼Œé‡‘é¢å’Œåœ°å€ä¿å¯†
```

#### Layer 2 æ‰©å®¹ï¼ˆå¦‚ zkSync, StarkNetï¼‰

```
é“¾ä¸Šï¼šåªå­˜å‚¨è¯æ˜ï¼ˆå°ï¼‰
é“¾ä¸‹ï¼šæ‰§è¡Œå¤§é‡äº¤æ˜“

éªŒè¯æˆæœ¬ï¼šO(1)
äº¤æ˜“ååé‡ï¼šâ†‘â†‘â†‘
```

### 2. èº«ä»½è®¤è¯

#### å¹´é¾„éªŒè¯

- è¿›å…¥æˆäººç½‘ç«™
- è´­ä¹°é…’ç²¾/çƒŸè‰
- ä¸æ³„éœ²å‡ºç”Ÿæ—¥æœŸ

#### ä¿¡ç”¨è¯„åˆ†

```go
type CreditScoreCircuit struct {
    Score      frontend.Variable `gnark:"score"`        // ç§æœ‰
    Threshold  frontend.Variable `gnark:",public"`      // å…¬å¼€ï¼šå¦‚ 700
    IsQualified frontend.Variable `gnark:",public"`     // å…¬å¼€
}
```

- è´·æ¬¾å®¡æ‰¹
- ä¿¡ç”¨å¡ç”³è¯·
- ä¸æ³„éœ²å…·ä½“åˆ†æ•°

### 3. æ•°æ®éšç§

#### åŒ»ç–—æ•°æ®

- è¯æ˜å·²æ¥ç§ç–«è‹—ï¼Œä¸æ³„éœ²å…¶ä»–å¥åº·ä¿¡æ¯
- è¯æ˜ç¬¦åˆä¸´åºŠè¯•éªŒæ¡ä»¶ï¼Œä¸æ³„éœ²ç—…å²

#### è´¢åŠ¡å®¡è®¡

- è¯æ˜æ”¶å…¥åœ¨æŸä¸ªèŒƒå›´ï¼Œä¸æ³„éœ²å…·ä½“é‡‘é¢
- è¯æ˜çº³ç¨åˆè§„ï¼Œä¸æ³„éœ²äº¤æ˜“ç»†èŠ‚

### 4. æ¸¸æˆä¸å¨±ä¹

#### å…¬å¹³æ¸¸æˆ

- æ‰‘å…‹ï¼šè¯æ˜å‡ºç‰Œåˆæ³•ä½†ä¸æ³„éœ²æ‰‹ç‰Œ
- å½©ç¥¨ï¼šå¯éªŒè¯çš„éšæœºæ€§

#### æˆå°±ç³»ç»Ÿ

- è¯æ˜æ¸¸æˆé€šå…³ä½†ä¸æ³„éœ²ç­–ç•¥
- è¯æ˜æŠ€èƒ½è¾¾æ ‡ä½†ä¸æ³„éœ²ç»ƒä¹ æ•°æ®

### 5. ä¾›åº”é“¾ä¸ç‰©æµ

#### äº§å“æº¯æº

- è¯æ˜äº§å“æ¥è‡ªè®¤è¯ä¾›åº”å•†
- ä¸æ³„éœ²ä¾›åº”é“¾ç»†èŠ‚ï¼ˆå•†ä¸šæœºå¯†ï¼‰

#### åˆè§„è¯æ˜

- è¯æ˜ç¬¦åˆç¯ä¿æ ‡å‡†
- ä¸æ³„éœ²ç”Ÿäº§å·¥è‰º

### 6. æœºå™¨å­¦ä¹ 

#### æ¨¡å‹æ¨ç†

```
ç”¨æˆ·ï¼šæˆ‘çš„æ•°æ® + æ¨¡å‹
æœåŠ¡å•†ï¼šæ¨ç†ç»“æœ

ZK ä¿æŠ¤ï¼š
- ç”¨æˆ·æ•°æ®ä¸æ³„éœ²
- æ¨¡å‹å‚æ•°ä¸æ³„éœ²
- ç»“æœå¯éªŒè¯
```

#### è”é‚¦å­¦ä¹ 

- è¯æ˜æ¨¡å‹è®­ç»ƒæ­£ç¡®
- ä¸æ³„éœ²æœ¬åœ°æ•°æ®

---

## æ€§èƒ½ä¼˜åŒ–

### 1. å‡å°‘çº¦æŸæ•°é‡

çº¦æŸæ•°é‡ç›´æ¥å½±å“æ€§èƒ½ï¼š

```go
// âŒ ä½æ•ˆï¼šå¤šæ¬¡å“ˆå¸Œ
hash1 := hashOnce(data)
hash2 := hashOnce(hash1)
hash3 := hashOnce(hash2)

// âœ… é«˜æ•ˆï¼šæ‰¹é‡å“ˆå¸Œ
hashBatch(data, iterations)
```

### 2. é€‰æ‹© ZK å‹å¥½çš„æ“ä½œ

| æ“ä½œ | çº¦æŸæˆæœ¬ | å»ºè®® |
|-----|---------|------|
| åŠ æ³•/å‡æ³• | ä½ | âœ… ä¼˜å…ˆä½¿ç”¨ |
| ä¹˜æ³• | ä¸­ | âœ… é€‚é‡ä½¿ç”¨ |
| é™¤æ³• | é«˜ | âš ï¸ å°½é‡é¿å… |
| SHA256 | æé«˜ï¼ˆ~25Kï¼‰ | âŒ é¿å… |
| MiMC | ä½ï¼ˆ~200ï¼‰ | âœ… æ¨è |
| Poseidon | ä½ï¼ˆ~150ï¼‰ | âœ… æœ€ä¼˜ |

### 3. ä½¿ç”¨æŸ¥æ‰¾è¡¨

å¯¹äºå›ºå®šæ˜ å°„å…³ç³»ï¼Œä½¿ç”¨æŸ¥æ‰¾è¡¨æ¯”è®¡ç®—æ›´é«˜æ•ˆï¼š

```go
// æŸ¥æ‰¾è¡¨ï¼šè¾“å…¥ â†’ è¾“å‡º
table := []int{0, 1, 4, 9, 16, 25} // xÂ²

// ç”µè·¯ä¸­ä½¿ç”¨
api.Lookup(input, table)
```

### 4. å¹¶è¡ŒåŒ–

```go
// Setup å¯ä»¥ç¦»çº¿å¹¶è¡ŒåŒ–
// Prove å¯ä»¥å¤šæ ¸åŠ é€Ÿ
// Verify æœ¬èº«å°±å¾ˆå¿«ï¼ˆ1-2msï¼‰

// æ‰¹é‡éªŒè¯å¤šä¸ªè¯æ˜
groth16.BatchVerify(proofs, vks, publicWitnesses)
```

### 5. é€‰æ‹©åˆé€‚çš„æ¤­åœ†æ›²çº¿

```go
// BN254ï¼šæœ€æµè¡Œï¼Œä»¥å¤ªåŠå…¼å®¹
ecc.BN254

// BLS12-381ï¼šæ›´å®‰å…¨ï¼ŒFilecoin/Chia ä½¿ç”¨
ecc.BLS12_381

// BLS12-377ï¼šé€‚åˆé€’å½’è¯æ˜
ecc.BLS12_377
```

---

## æœ€ä½³å®è·µ

### 1. ç”µè·¯è®¾è®¡åŸåˆ™

#### æ˜ç¡®éšç§è¾¹ç•Œ

```go
type WellDesignedCircuit struct {
    // âœ… æ˜ç¡®æ ‡è®°ç§æœ‰/å…¬å¼€
    Secret frontend.Variable `gnark:"secret"`
    Public frontend.Variable `gnark:",public"`
}
```

#### æœ€å°åŒ–å…¬å¼€ä¿¡æ¯

```go
// âŒ è¿‡åº¦å…¬å¼€
type BadCircuit struct {
    Age     frontend.Variable `gnark:",public"`  // ä¸éœ€è¦å…¬å¼€å…·ä½“å¹´é¾„
    IsAdult frontend.Variable `gnark:",public"`
}

// âœ… æœ€å°å…¬å¼€
type GoodCircuit struct {
    Age     frontend.Variable `gnark:"age"`      // ç§æœ‰
    IsAdult frontend.Variable `gnark:",public"`  // åªå…¬å¼€ç»“æœ
}
```

### 2. å®‰å…¨è€ƒè™‘

#### å¯ä¿¡è®¾ç½®

Groth16 éœ€è¦å¯ä¿¡è®¾ç½®ï¼Œå¿…é¡»å®‰å…¨è¿›è¡Œï¼š

```
æ–¹æ¡ˆ1ï¼šä½¿ç”¨å·²æœ‰çš„å¯ä¿¡è®¾ç½®ï¼ˆå¦‚ Powers of Tauï¼‰
æ–¹æ¡ˆ2ï¼šä¸¾åŠå¤šæ–¹è®¡ç®—ï¼ˆMPCï¼‰ä»ªå¼
æ–¹æ¡ˆ3ï¼šä½¿ç”¨ä¸éœ€è¦å¯ä¿¡è®¾ç½®çš„åç«¯ï¼ˆPlonK, STARKï¼‰
```

#### é˜²æ­¢ä¾§ä¿¡é“æ”»å‡»

```go
// âŒ å±é™©ï¼šæ¡ä»¶åˆ†æ”¯å¯èƒ½æ³„éœ²ä¿¡æ¯
if secret > 100 {
    // ... ä¸åŒçš„è®¡ç®—è·¯å¾„
}

// âœ… å®‰å…¨ï¼šæ’å®šæ—¶é—´æ“ä½œ
result := api.Select(api.Cmp(secret, 100), branch1, branch2)
```

### 3. æµ‹è¯•ç­–ç•¥

#### å®Œæ•´çš„æµ‹è¯•è¦†ç›–

```go
func TestCircuit(t *testing.T) {
    // æµ‹è¯•1ï¼šæ­£å¸¸æƒ…å†µ
    testValid(t)
    
    // æµ‹è¯•2ï¼šè¾¹ç•Œæƒ…å†µ
    testBoundary(t)
    
    // æµ‹è¯•3ï¼šå¼‚å¸¸æƒ…å†µï¼ˆåº”è¯¥å¤±è´¥ï¼‰
    testInvalid(t)
}
```

#### æ¨¡ç³Šæµ‹è¯•

```go
// ä½¿ç”¨éšæœºè¾“å…¥æµ‹è¯•ç”µè·¯é²æ£’æ€§
for i := 0; i < 1000; i++ {
    randomInput := generateRandom()
    testCircuit(randomInput)
}
```

### 4. ç”Ÿäº§éƒ¨ç½²

#### å¯†é’¥ç®¡ç†

```
Setup é˜¶æ®µï¼š
1. åœ¨å®‰å…¨ç¯å¢ƒä¸­ç”Ÿæˆ pk, vk
2. é”€æ¯ Setup çš„éšæœºæ€§ï¼ˆtoxic wasteï¼‰
3. pk åŠ å¯†å­˜å‚¨ï¼ˆè¯æ˜ç”Ÿæˆæ–¹ï¼‰
4. vk å¯ä»¥å…¬å¼€ï¼ˆéªŒè¯æ–¹ï¼‰
```

#### ç‰ˆæœ¬æ§åˆ¶

```go
type Circuit struct {
    Version frontend.Variable `gnark:",public"`
    // ... å…¶ä»–å­—æ®µ
}

// ç¡®ä¿è¯æ˜å’Œç”µè·¯ç‰ˆæœ¬åŒ¹é…
```

#### ç›‘æ§ä¸æ—¥å¿—

```go
// è®°å½•å…³é”®æŒ‡æ ‡
log.Printf("Prove time: %v", proveTime)
log.Printf("Constraints: %d", ccs.GetNbConstraints())
log.Printf("Proof size: %d bytes", len(proof))
```

---

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•é€‰æ‹©åˆé€‚çš„å“ˆå¸Œå‡½æ•°ï¼Ÿ

**A:** æ ¹æ®åœºæ™¯é€‰æ‹©ï¼š

```
é€šç”¨åœºæ™¯ï¼šMiMC æˆ– Poseidon
éœ€è¦ä¸å¤–éƒ¨ç³»ç»Ÿå…¼å®¹ï¼šSHA256ï¼ˆä½†æ€§èƒ½å·®ï¼‰
é€’å½’è¯æ˜ï¼šPoseidonï¼ˆä¸“é—¨ä¼˜åŒ–ï¼‰
æœ€ä½³æ€§èƒ½ï¼šPoseidon
```

### Q2: çº¦æŸæ•°é‡å¦‚ä½•å½±å“æ€§èƒ½ï¼Ÿ

**A:** 
- **Prove æ—¶é—´**ï¼šçº¿æ€§ç›¸å…³ï¼ˆçº¦æŸè¶Šå¤šè¶Šæ…¢ï¼‰
- **Verify æ—¶é—´**ï¼šå‡ ä¹æ’å®šï¼ˆ~1-2msï¼Œä¸çº¦æŸæ•°é‡æ— å…³ï¼ï¼‰
- **Proof å¤§å°**ï¼šGroth16 å›ºå®šï¼ˆ~200 bytesï¼‰

### Q3: å¦‚ä½•è°ƒè¯•ç”µè·¯ï¼Ÿ

**A:**
```go
// æ–¹æ³•1ï¼šæ‰“å°ä¸­é—´å€¼
fmt.Printf("Debug value: %v\n", value)

// æ–¹æ³•2ï¼šä½¿ç”¨ gnark çš„è°ƒè¯•æ¨¡å¼
frontend.Compile(..., frontend.WithDebug())

// æ–¹æ³•3ï¼šå•å…ƒæµ‹è¯•æ¯ä¸ªçº¦æŸ
testConstraint(t, constraint1)
testConstraint(t, constraint2)
```

### Q4: èƒ½å¦åœ¨ç”µè·¯ä¸­ä½¿ç”¨æµ®ç‚¹æ•°ï¼Ÿ

**A:** ä¸èƒ½ç›´æ¥ä½¿ç”¨ã€‚ZK ç”µè·¯å·¥ä½œåœ¨æœ‰é™åŸŸä¸Šï¼ˆæ•´æ•°è¿ç®—ï¼‰ã€‚

è§£å†³æ–¹æ¡ˆï¼š
```go
// å®šç‚¹æ•°ï¼šæ”¾å¤§ 10^6 å€
price := 123.45
priceInCircuit := 123450000  // ä¹˜ä»¥ 10^6

// ç”µè·¯å†…è®¡ç®—åå†è¿˜åŸ
```

### Q5: å¦‚ä½•å¤„ç†å¤§æ•°ç»„ï¼Ÿ

**A:**
```go
// âŒ ä¸æ¨èï¼šæ•°ç»„å¤ªå¤§
type Circuit struct {
    Data [10000]frontend.Variable
}

// âœ… æ¨èï¼šä½¿ç”¨ Merkle æ ‘
type Circuit struct {
    MerkleRoot frontend.Variable
    MerklePath []frontend.Variable
}
```

### Q6: Groth16 vs PlonK å¦‚ä½•é€‰æ‹©ï¼Ÿ

| ç‰¹æ€§ | Groth16 | PlonK |
|-----|---------|-------|
| å¯ä¿¡è®¾ç½® | æ¯ä¸ªç”µè·¯éœ€è¦ | é€šç”¨è®¾ç½®ï¼ˆä¸€æ¬¡æ€§ï¼‰|
| è¯æ˜å¤§å° | æ›´å°ï¼ˆ~200Bï¼‰ | è¾ƒå¤§ï¼ˆ~400Bï¼‰ |
| éªŒè¯é€Ÿåº¦ | æœ€å¿« | å¿« |
| çµæ´»æ€§ | ä½ | é«˜ï¼ˆæ”¯æŒè‡ªå®šä¹‰é—¨ï¼‰|
| æˆç†Ÿåº¦ | â­â­â­â­â­ | â­â­â­â­ |

**å»ºè®®**ï¼š
- ç”Ÿäº§ç¯å¢ƒã€æ€§èƒ½å…³é”® â†’ Groth16
- å¿«é€Ÿè¿­ä»£ã€é¢‘ç¹ä¿®æ”¹ç”µè·¯ â†’ PlonK

### Q7: å¦‚ä½•å®ç°é€’å½’è¯æ˜ï¼Ÿ

é€’å½’è¯æ˜ï¼šåœ¨ç”µè·¯å†…éªŒè¯å¦ä¸€ä¸ªè¯æ˜ã€‚

```go
type RecursiveCircuit struct {
    // å†…éƒ¨è¯æ˜
    InnerProof frontend.Variable
    
    // éªŒè¯å¯†é’¥
    InnerVK frontend.Variable
}

func (c *RecursiveCircuit) Define(api frontend.API) error {
    // åœ¨ç”µè·¯å†…éªŒè¯ InnerProof
    verifier := groth16.NewVerifier(api)
    verifier.Verify(c.InnerProof, c.InnerVK)
    return nil
}
```

**åº”ç”¨**ï¼šåŒºå—é“¾å‹ç¼©ï¼ˆè¯æ˜é“¾å‹ç¼©ä¸ºå•ä¸ªè¯æ˜ï¼‰

---

## å­¦ä¹ èµ„æº

### å®˜æ–¹æ–‡æ¡£

- [gnark GitHub](https://github.com/ConsenSys/gnark)
- [gnark æ–‡æ¡£](https://docs.gnark.consensys.net/)
- [gnark-crypto](https://github.com/ConsenSys/gnark-crypto)

### æ¨èé˜…è¯»

#### ç†è®ºåŸºç¡€
- ğŸ“˜ [ZK å­¦ä¹ èµ„æº](https://zkp.science/)
- ğŸ“˜ [Groth16 è®ºæ–‡](https://eprint.iacr.org/2016/260)
- ğŸ“˜ [Why and How zk-SNARK Works](https://arxiv.org/abs/1906.07221)

#### å®æˆ˜æ•™ç¨‹
- ğŸ’» [gnark å®˜æ–¹ç¤ºä¾‹](https://github.com/ConsenSys/gnark/tree/master/examples)
- ğŸ’» [ZK Hack](https://zkhack.dev/)
- ğŸ’» [0xPARC Learning Resources](https://learn.0xparc.org/)


---

## é¡¹ç›®å®æˆ˜ï¼šæ„å»ºå®Œæ•´ç³»ç»Ÿ

### ç«¯åˆ°ç«¯ç¤ºä¾‹ï¼šéšç§æŠ•ç¥¨ç³»ç»Ÿ

å®Œæ•´ä»£ç è§æœ¬ä»“åº“çš„ `lesson*.go` æ–‡ä»¶ã€‚

#### ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯    â”‚ â†’ ç”ŸæˆæŠ•ç¥¨è¯æ˜
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ proof + å…¬å¼€ä¿¡æ¯
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æœåŠ¡å™¨    â”‚ â†’ éªŒè¯è¯æ˜
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ è®°å½•æŠ•ç¥¨
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åŒºå—é“¾/DB  â”‚ â†’ å­˜å‚¨ç»“æœ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ ¸å¿ƒç‰¹æ€§

âœ… æŠ•ç¥¨éšç§ï¼ˆä¸çŸ¥é“è°æŠ•ç»™è°ï¼‰
âœ… ä¸€äººä¸€ç¥¨ï¼ˆé˜²æ­¢é‡å¤æŠ•ç¥¨ï¼‰
âœ… å¯éªŒè¯æ€§ï¼ˆä»»ä½•äººéƒ½èƒ½éªŒè¯ç»“æœï¼‰
âœ… æŠ—å¼ºåˆ¶ï¼ˆæ— æ³•è¯æ˜ä½ çš„æŠ•ç¥¨ï¼‰

---
